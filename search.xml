<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>iptables</title>
      <link href="/2018/04/iptables%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2018/04/iptables%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      <content type="html"><![CDATA[<p>Centos6 及以下RHEL系统版本默认使用的防火墙软件</p><p>iptables拥有强大的功能，配合Linux的路由转发就是一个可自定策略的路由器</p><a id="more"></a><h2 id="iptables防火墙配置"><a href="#iptables防火墙配置" class="headerlink" title="iptables防火墙配置"></a>iptables防火墙配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开启iptables</span></span><br><span class="line">service iptables start | stop | status | restart</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机运行</span></span><br><span class="line">chkconifg iptables on</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除默认配置</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="meta">#</span><span class="bash"> 永久生效</span></span><br><span class="line">service iptables save</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看配置</span></span><br><span class="line">cat /etc/sysconifg/iptables</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 语法格式</span></span><br><span class="line">iptables -t 表名 管理选项 链名 匹配条件 -j 处理动作</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表名 [默认4张表，功能不同]：</span></span><br><span class="line">filter表：对到达防火墙服务器的ip包做过滤</span><br><span class="line">nat表：...ip包中的源ip地址或目标ip地址或端口做转换</span><br><span class="line">mangle表：...ip包打标记</span><br><span class="line">raw表：...ip包做状态跟踪</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 管理选项 [默认对filter表操作]</span></span><br><span class="line">-F 清空表中规则</span><br><span class="line">-L 显示表中规则</span><br><span class="line">-n 以数字方式显示ip地址及端口</span><br><span class="line">--line-numbers 添加显示行号</span><br><span class="line">-----------------------------</span><br><span class="line">-A 表添加新规则，默认添加在末尾</span><br><span class="line">-I 行号 ；插入新规则</span><br><span class="line">-D 行号 ；删除某条规则</span><br><span class="line">-P 设置链默认规则（ACCEPT/DROP）</span><br><span class="line">*防火墙启动后默认所有表中所有链的默认规则都放行ACCEPT*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 链名 [匹配数据包的传输方向]</span></span><br><span class="line">INPUT    匹配进入防火墙本机的ip包</span><br><span class="line">OUTPUT    匹配从防护墙本机出去的ip包</span><br><span class="line">FORWARD     匹配经过防火墙主机的ip包</span><br><span class="line">PREROUTING  处理路由前的ip包</span><br><span class="line">POSTROUTING 处理路由后的ip包</span><br><span class="line"></span><br><span class="line">匹配条件</span><br><span class="line">-p 协议 tcp | udp |icmp ...</span><br><span class="line">-s 源地址</span><br><span class="line">-d 目的地址</span><br><span class="line">--sport 源端口号 </span><br><span class="line">--dport 目标端口号</span><br><span class="line"></span><br><span class="line">处理动作 [决定如何处理与条件匹配的ip包]</span><br><span class="line">ACCEPT 放行 </span><br><span class="line">DROP   丢弃    （无反馈）</span><br><span class="line">REJECT 拒绝   （反馈）</span><br><span class="line">SNAT 源地址转换 （修改ip包）</span><br><span class="line">DNAT 目的地址转换 （修改ip包）</span><br></pre></td></tr></table></figure><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> host61，只允许192.168.4.254的主机访问自己的ssh服务。</span></span><br><span class="line">iptables -t filter -A INPUT -s 192.168.4.254 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -t filter -P INPUT  DROP</span><br><span class="line">iptables -t filter -nL INPUT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在61主机上添加1条新的规则，允许网络中的所有主机访问本机的网站服务。</span></span><br><span class="line">iptables -t filter -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在61主机上，不允许192.168.4.67主机访问本机的网站服务。</span></span><br><span class="line">iptables -t filter -I INPUT 2 -s 192.168.4.67 -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在61可以ping网络中的其他主机 ，但其他主机不可以ping61主机</span></span><br><span class="line">iptables -t filter -A INPUT -p icmp --help</span><br><span class="line">iptables -t filter -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在61上，仅允许主机254可以ping 主机61</span></span><br><span class="line">iptables -t filter -A INPUT -s 192.168.4.254 -p icmp --icmp-type echo-request -j ACCEPT</span><br><span class="line">service iptables  save</span><br></pre></td></tr></table></figure><h2 id="配置Linux网络防火墙"><a href="#配置Linux网络防火墙" class="headerlink" title="配置Linux网络防火墙"></a>配置Linux网络防火墙</h2><blockquote><p>防火墙开启路由转发</p><p>客户端网关指向防火墙</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拓扑：</span></span><br><span class="line">host2.66---&gt;eth1 host68 eth0 &lt;---host4.67</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> host68：</span></span><br><span class="line">eth0：192.168.4.68</span><br><span class="line">eth1：192.168.2.68</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启路由转发</span></span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forword = 1</span><br><span class="line">sysctl -p </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> host66:</span></span><br><span class="line">eth1:192.168.2.66/24 gw:192.168.2.68</span><br><span class="line"><span class="meta">#</span><span class="bash"> host67:</span></span><br><span class="line">eth0:192.168.4.67/24 gw:192.168.4.68</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> host68:防火墙规则不允许所有ip包经过 </span></span><br><span class="line">iptables -t filter -P FORWARD DROP</span><br><span class="line">iptables -L FORWARD</span><br><span class="line"><span class="meta">#</span><span class="bash"> host68:放行67访问66主机ssh的ip包</span></span><br><span class="line">iptables -t filter -A FORWARD 匹配条件 -j ACCEPT</span><br><span class="line">条件1： -s 192.168.2.66 -d 192.168.4.67 -p tcp --dport 22</span><br><span class="line">条件2： -s 192.168.4.67 -d 192.168.2.66 -p tcp --sport 22</span><br><span class="line"><span class="meta">#</span><span class="bash"> 放行所有主机访问网站的请求</span></span><br><span class="line">iptables -t filter -A FORWARD -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -t filter -A FORWARD -p tcp --sport 80 -j ACCEPT</span><br></pre></td></tr></table></figure><h2 id="Linux路由器配置"><a href="#Linux路由器配置" class="headerlink" title="Linux路由器配置"></a>Linux路由器配置</h2><blockquote><p>将Linux配置成路由器，使用NAT表上网，POSTROUTING链</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拓扑：</span></span><br><span class="line">外网eth1：192.168.2.0/24</span><br><span class="line">内网eth0：192.168.4.0/24</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 环境：</span></span><br><span class="line">host68：</span><br><span class="line">iptables -t filter -F</span><br><span class="line">iptables -t filter -P FORWARD ACCEPT</span><br><span class="line"></span><br><span class="line">host66：删除网关，192.168.2.66/24，搭建测试网站</span><br><span class="line">host67：eth0-192.168.4.67/24 gw-192.168.4.68</span><br><span class="line">host65: eth0-192.168.4.65/24 gw-192.168.4.68</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> host68：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用68公网ip共享上网</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.4.0/24 -o eth1 -j SNAT --to-source 192.168.2.68</span><br><span class="line"><span class="meta">#</span><span class="bash"> 映射内网67网站</span></span><br><span class="line">iptables -t nat -A PREROUTING -i eth1 -d 192.168.2.68 \</span><br><span class="line">-p tcp --dport 80 -j DNAT --to-destination 192.168.4.67</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除路由规则</span></span><br><span class="line">iptables -t nat -nL</span><br><span class="line">iptables -t nat -D PREROTING 1</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
            <tag> Linux </tag>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Keeplived+LVS/DR 高可用集群</title>
      <link href="/2018/04/Keepalived-LVS-DR/"/>
      <url>/2018/04/Keepalived-LVS-DR/</url>
      <content type="html"><![CDATA[<p>实验环境：Centos6.7</p><p>搭建高可用LVS负载均衡服务器</p><a id="more"></a><h2 id="LVS-DR环境搭建"><a href="#LVS-DR环境搭建" class="headerlink" title="LVS/DR环境搭建"></a>LVS/DR环境搭建</h2><blockquote><p>硬件环境：host62,host63, host68分发器，关闭防火墙、SELINUX</p><p>keepalived实验中仅需装包，配置开机自启</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>host65/68:</span><br><span class="line"><span class="meta">#</span> 手动添加VIP Keepalived不做</span><br><span class="line"><span class="meta">#</span> ifconfig eth0:1 192.168.4.100/32</span><br><span class="line"><span class="meta">#</span> 安装LVS</span><br><span class="line">yum install -y ipvsadm</span><br><span class="line"><span class="meta">#</span> 创建VS虚拟服务,轮询算法</span><br><span class="line">ipvsadm -A -t 192.168.4.100:80 -s rr</span><br><span class="line"><span class="meta">#</span> 添加RS，DR模式</span><br><span class="line">ipvsadm -a -t 192.168.4.100:80 -r 192.168.4.62 -g</span><br><span class="line">ipvsadm -a -t 192.168.4.100:80 -r 192.168.4.63 -g</span><br><span class="line"><span class="meta">#</span> 保存配置</span><br><span class="line">service ipvsadm save</span><br><span class="line"><span class="meta">#</span> 启动服务</span><br><span class="line">service ipvsadm start</span><br><span class="line"><span class="meta">#</span> 查看数据包</span><br><span class="line">ipvsadm -Ln</span><br></pre></td></tr></table></figure><h2 id="LRS环境设置"><a href="#LRS环境设置" class="headerlink" title="LRS环境设置"></a>LRS环境设置</h2><blockquote><p>web62、63为LVS做准备配置</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 配置VIP到本地回环lo:1</span><br><span class="line">ifconfig lo:1 192.168.4.100/32</span><br><span class="line"><span class="meta">#</span> 写到开机自动执行配置</span><br><span class="line">echo "以上配置" &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="meta">#</span> web环境搭建</span><br><span class="line">yum install -y httpd</span><br><span class="line">service httpd start</span><br><span class="line">chkconfig httpd on</span><br></pre></td></tr></table></figure><h2 id="Keepalived-LVS-DR"><a href="#Keepalived-LVS-DR" class="headerlink" title="Keepalived + LVS/DR"></a>Keepalived + LVS/DR</h2><blockquote><p>环境要求：分发器65、68 不需手动绑定VIP，只需装包、设置自启</p><p>原理：Keeplalived自动检测主VS状态，自动配置ipvsadm</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>host65/68:</span><br><span class="line"><span class="meta">#</span> 安装keepalived</span><br><span class="line">yum install -y keepalived</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>host65[主]/68[b备]</span><br><span class="line">rpm -qc keepalived</span><br><span class="line">vim /etc/keepalived/keepalived.conf</span><br><span class="line">---</span><br><span class="line">...上面配置不用改</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER [68:BACKUP]</span><br><span class="line">    interface eth0    virtual_router_id 51</span><br><span class="line">    priority 150 [68:100]</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.4.100    </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span>ipvsadm -A -t...=</span><br><span class="line">virtual_server 192.168.4.100 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    nat_mask 255.255.255.0</span><br><span class="line">    # persistence_timeout 50 </span><br><span class="line">    #50s内对同一Client只分发一台web</span><br><span class="line">    protocol TCP</span><br><span class="line">    connect_timeout 3</span><br><span class="line">    nb_get_retry 3    </span><br><span class="line">    delay_before_retry 3</span><br><span class="line"><span class="meta">#</span>ipvsadm -a -t ...=    </span><br><span class="line">    real_server 192.168.4.62 80 &#123;</span><br><span class="line">        weight 1        </span><br><span class="line">        &#125;</span><br><span class="line">    real_server 192.168.4.63 80 &#123;        </span><br><span class="line">        weight 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">下面多余行删除</span><br><span class="line"><span class="meta">#</span> 65改完后scp到68，修改描述值、优先级</span><br><span class="line">scp /etc/keepalived/keepalived.conf 192.168.4.68:/etc/keepalived/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 启动Keepalived，Client验证配置</span><br><span class="line">service keepalived start</span><br><span class="line">chkconfig keepalived on</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Client</span><br><span class="line">curl 192.168.4.100</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Cluster </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Keeplived 高可用集群</title>
      <link href="/2018/04/Keepalived-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/"/>
      <url>/2018/04/Keepalived-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/</url>
      <content type="html"><![CDATA[<p>Keepalived软件可以做任意单故障节点的高可用集群</p><p>系统环境：Centos6.7</p><a id="more"></a><h2 id="使用Keepalived部署-高可用集群-（HA）"><a href="#使用Keepalived部署-高可用集群-（HA）" class="headerlink" title="使用Keepalived部署 高可用集群 （HA）"></a>使用Keepalived部署 高可用集群 （HA）</h2><p><em>Keepalived软件可以做任意单故障节点的高可用集群</em></p><blockquote><p>环境要求：将host66+67配置为HA集群，正在被用户访问的66做主，67为备。</p><p>使用目标：66宕机后，67自动响应，Client访问192.168.4.101</p></blockquote><!--more--><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Client</span><br><span class="line">   |</span><br><span class="line">VIP:4.100</span><br><span class="line">   |</span><br><span class="line">  -----------</span><br><span class="line">Kp66  Kp67</span><br></pre></td></tr></table></figure><h3 id="安装配置主备Keepalived"><a href="#安装配置主备Keepalived" class="headerlink" title="安装配置主备Keepalived"></a>安装配置主备Keepalived</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">yum install -y keepalived</span><br><span class="line">service keepalived status</span><br><span class="line">chkconfig keepalived on</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>修改配置文件</span><br><span class="line">rpm -qc keepalived</span><br><span class="line">/etc/keepalived/keepalived.conf</span><br><span class="line">/etc/sysconfig/keepalived</span><br><span class="line"><span class="meta">#</span> 先改66，主</span><br><span class="line">vim /etc/keepalived/keepalived.conf</span><br><span class="line">global_defs&#123;...&#125; # 按需修改，主备一样</span><br><span class="line">：30</span><br><span class="line">1000dd</span><br><span class="line">15 vrrp_instance VI_1 &#123;#VI_1集群名，按需修改</span><br><span class="line">16     state MASTER #描述信息，MASTER非关键字</span><br><span class="line">       ...</span><br><span class="line">19     priority 150 # 优先级+50  </span><br><span class="line">21     authentication &#123;</span><br><span class="line">22         auth_type PASS  #验证方式为密码</span><br><span class="line">23         auth_pass 123456 #密码</span><br><span class="line">24     &#125; </span><br><span class="line">25     virtual_ipaddress &#123;</span><br><span class="line">26          192.168.4.101</span><br><span class="line">27      &#125; #虚拟ip</span><br><span class="line">28 &#125; #定义集群</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将文件传给备67</span><br><span class="line">scp /etc/keepalived/keepalived.conf 192.168.4.67:/etc/keepalived/</span><br><span class="line"><span class="meta">#</span> 修改备67</span><br><span class="line">vim /etc/keepalived/keepalived.conf</span><br><span class="line">15 vrrp_instance VI_1 &#123;</span><br><span class="line">16     state BACKUP</span><br><span class="line">17     interface eth0</span><br><span class="line">18     virtual_router_id 51</span><br><span class="line">19     priority 100</span><br><span class="line">20     advert_int 1</span><br><span class="line">21     authentication &#123;</span><br><span class="line">22         auth_type PASS</span><br><span class="line">23         auth_pass 123456</span><br><span class="line">24     &#125;</span><br><span class="line">25     virtual_ipaddress &#123;</span><br><span class="line">26         192.168.4.101</span><br><span class="line">27     &#125;</span><br><span class="line">28 &#125;</span><br></pre></td></tr></table></figure><h3 id="启动并验证服务"><a href="#启动并验证服务" class="headerlink" title="启动并验证服务"></a>启动并验证服务</h3><p><em>先启动主服务器66</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 66启动服务</span><br><span class="line">service keepalived start</span><br><span class="line"><span class="meta">#</span> 查看VIP</span><br><span class="line">ip add | grep 192.168.4</span><br><span class="line">    inet 192.168.4.66/24 brd 192.168.4.255 scope global eth0</span><br><span class="line">    inet 192.168.4.101/32 scope global eth0</span><br><span class="line"><span class="meta">#</span> 67同理启用</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 验证主备，关闭66服务，查看67ip</span><br><span class="line"><span class="meta">#</span> 66恢复后优先级高，夺回VIP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Clien：</span><br><span class="line">curl 192.168.4.101</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Cluster </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>LVS 负载均衡集群搭建</title>
      <link href="/2018/04/LVS-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
      <url>/2018/04/LVS-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</url>
      <content type="html"><![CDATA[<p>集群：使用一组服务器提供相同的服务<br>集群分类：<br>LB:  一组服务器平均分摊客户端的多次连接请求<br>HA:  主备模式 主是正在提供服务的主机 当主宕机后，备用主机自动接替服务。对客户端来说是透明的。<br>HPC: 高计算集群 应用专业领域（航天、航空 勘探 科学计算 天气）</p><a id="more"></a><h2 id="配置负载均衡集群："><a href="#配置负载均衡集群：" class="headerlink" title="配置负载均衡集群："></a>配置负载均衡集群：</h2><p>1.1 使用ipvsadm软件部署(LVS)<br>1.1.1 软件介绍<br>1.1.2 LVS术语：<br>            RealServer：真正提供服务的主机<br>            DirectorServer：调度服务器，作用是接收客户端访问服务的请求，并根据使用的算法把请求分发给RealServer<br>            VIP 虚拟ip：客户端访问集群时，访问的地址<br>            RIP 真实ip：部署在应用服务器上的IP地址<br>            DIP 直连ip：调度器服务器与应用服务器ip处于同一网络的ip</p><p>1.1.3 LVS工作模式：<br>            NAT模式：地址转换模板*<br>            DR模式：直连路由模式 ** 分发器只负责分发客户端的请求给realserver 直接和客户端通信<br>            TUN模式：隧道模式</p><p>LVS支持10种调度算法 常用4钟：<br>rr 轮询 把请求平均分发给realserver<br>wrr 加权轮询 根据realserver的权重值 分发连接请求<br>lc  最少连接    根据rs当前的连接数分发<br>wlc 加权最少连接    分发时除了看连接数外 还要看 权重值</p><h2 id="配置LVS-NAT模式的负载均衡集群"><a href="#配置LVS-NAT模式的负载均衡集群" class="headerlink" title="配置LVS/NAT模式的负载均衡集群"></a>配置LVS/NAT模式的负载均衡集群</h2><pre><code>    client：2.253         |      eth1:2.65    分发器65 lvs/nat     eth0:4.65         |------------------- |               |web62           web63 eth0            eth0</code></pre><h3 id="配置NAT运行环境"><a href="#配置NAT运行环境" class="headerlink" title="配置NAT运行环境"></a>配置NAT运行环境</h3><ol><li><p>给realserver配置网关地址<br>查看路由：route -n<br>临时：route add/del default gw 192.168.4.65<br>永久：vim /etc/sysconfig/network-scripts/ifcfg-eth0 </p></li><li><p>在分发器65上开启路由转发功能</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line"> net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li><li><p>在RealServer上运行网站 并写编网页</p></li></ol><h3 id="配置LVS-NAT模式的LB集群："><a href="#配置LVS-NAT模式的LB集群：" class="headerlink" title="配置LVS/NAT模式的LB集群："></a>配置LVS/NAT模式的LB集群：</h3><p><em>要求：65主机把接收到的访问网站请求平均分发给网站服务器62.63<br>分发器65配置如下：</em></p><ol><li>装包<blockquote><p>yum install -y ipvsadm<br>service ipvsadm status<br>which ipvsadm<br> -A 添加虚拟服务器<br> -t 设置集群地址（VIP）<br> -s 指定负载调度算法<br> -C 清除配置<br> -a 添加RS<br> -L list<br> -m NAT模式  </p></blockquote></li><li>创建虚拟服务<blockquote><p>ipvsadm -A -t 192.168.2.65:80 -s rr<br>ipvsadm -Ln # 查看  </p></blockquote></li></ol><ol start="3"><li>添加RealServer<blockquote><p>ipvsadm -a -t 192.168.2.65:80 -r 192.168.4.62:80 -m<br>ipvsadm -a -t 192.168.2.65:80 -r 192.168.4.63:80 -m<br>ipvsadm -Ln  </p></blockquote></li></ol><ol start="4"><li><p>保存设置</p><blockquote><p>service ipvsadm save<br> <em>ipvsadm: Saving IPVS table to /etc/sysconfig/ipvsadm:      [确定]</em><br>cat /etc/sysconfig/ipvsadm<br> -A -t 192.168.2.65:80 -s rr<br> -a -t 192.168.2.65:80 -r 192.168.4.62:80 -m -w 1<br> -a -t 192.168.2.65:80 -r 192.168.4.63:80 -m -w 1  </p></blockquote></li><li><p>在客户端验证<br>!!!! RS 只能有一块网卡eth0<br>curl 192.168.2.65</p></li><li><p>修改设置</p><blockquote><p>ipvsadm -E -t 192.168.2.65:80 -s wrr # 修改调度算法<br>ipvsadm -e -t 192.168.2.65:80 -r 192.168.4.63:80 -w 3 -m # 修改权重值<br>ipvsadm -d -t 192.168.2.65:80 -r 192.168.4.63:80<br>ipvsadm -Z # 访问计数清零，改权后必须<br>ipvsadm -D -t 192.168.2.65:80 # 删除虚拟服务器<br>ipvsadm -C # 清除虚拟服务<br>ipvsadm -Ln<br>service ipvsadm save # 使设置生效</p></blockquote></li></ol><hr><h2 id="配置LVS-DR模式的负载均衡集群"><a href="#配置LVS-DR模式的负载均衡集群" class="headerlink" title="配置LVS/DR模式的负载均衡集群"></a>配置LVS/DR模式的负载均衡集群</h2><pre><code>--------client：4.253------|            |            ||        eth0:4.100       ||       分发器65lvs/dr    ||        eth0:4.65        | |            |            |---------------------------     |               |   web62           web63    eth0            eth0</code></pre><p>环境配置：<br>删除RS网关<br>关闭VS路由转发、eth1网卡  </p><p><em>要求：client通过vip192.168.4.100访问集群62.63 </em></p><ol><li><p>配置RS[62.63]<br>a. 运行网站服务 略<br>b. 绑定VIP  </p><blockquote><p>ifconfig lo:1 192.168.4.100/32<br>echo “ifconfig lo:1 192.168.4.100/32” &gt;&gt; /etc/rc.local #写进开机启动配置  </p></blockquote><p>c. 修改本机网络接口的内核参数<br>cd /proc/sys/net/ipv4/conf<br>vim /etc/rc.local<br>echo 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore<br>echo 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce<br>echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore<br>echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce   </p></li><li><p>配置VS<br>a. 绑定VIP<br>vim /etc/rc.local<br>ifconfig eth0:1 192.168.4.100/32<br>b. 安装LVS软件包<br>rpm -qa ipvsadm<br>c. 创建LVS<br>ipvsadm -A -t 192.168.4.100:80 -s rr<br>d. 添加RS<br>ipvsadm -a -t 192.168.4.100:80 -r 192.168.4.62:80 -g<br>ipvsadm -a -t 192.168.4.100:80 -r 192.168.4.63:80 -g<br>e. 保存设置<br>service ipvsadm save<br>f. 查看配置<br>ipvsadm -Ln<br>ipvsadm -Ln –stats</p></li><li><p>测试<br>访问VIP浏览网页</p></li></ol><h2 id="LVS缺点"><a href="#LVS缺点" class="headerlink" title="LVS缺点"></a>LVS缺点</h2><p>VS单点故障<br>无七层业务负载均衡</p>]]></content>
      
      
        <tags>
            
            <tag> Cluster </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ISCSI-后端存储</title>
      <link href="/2018/04/%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8/"/>
      <url>/2018/04/%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8/</url>
      <content type="html"><![CDATA[<p>存储介质 ： 内存 硬盘<br>存储位置：本地，网络，云</p><p>存储通信方式：SCSI [ 小型计算机系统接口 ]，FC [ 光纤通道 ]</p><p>存储技术:<br>        DAS直连式存储(快，不可共享，扩展性低)<br>        共享存储：<br>        NAS：NFS，CIFS[samba]<br>        SAN：ISCSI</p><a id="more"></a><p><img src="images/1-1.png" alt="1-1"></p><p>配置iSCSI</p><pre><code>  client61web62   web63存储storage64，+3G*2</code></pre><p>配置存储服务器64<br>要求：把本机的2块硬盘共享给网络中的所有主机</p><p>配置步骤：</p><p>1.后端存储</p><pre><code>1.装包yum list | grep scsiyum install scsi-target-utils2.配置</code></pre><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/tgt/targets.conf</span><br><span class="line"></span><br><span class="line">62 &lt;target iqn.2018-04.cn.tedu:rh64.diskb&gt; #...描述信息</span><br><span class="line">63     backing-store /dev/vdb      # 共享的磁盘</span><br><span class="line">64     write-cache off             # 写缓存</span><br><span class="line">65     # initiator-address 192.168.4.62  # 限制共享主机</span><br><span class="line">66     # initiator-address 192.168.4.63</span><br><span class="line">67     vendor_id tarena    # 厂商名</span><br><span class="line">68     product_id disktwo  # 型号</span><br><span class="line">69 &lt;/target&gt;</span><br><span class="line">70</span><br><span class="line">71 &lt;target iqn.2018-04.cn.tedu:rh64.diskc&gt; #iqn.日期.反域名:主机名.描述信息</span><br><span class="line">72     backing-store /dev/vdc      # 共享的磁盘</span><br><span class="line">73     write-cache off             # 写缓存</span><br><span class="line">74     # initiator-address 192.168.4.62  # 限制共享主机</span><br><span class="line">75     # initiator-address 192.168.4.63</span><br><span class="line">76     vendor_id tarena    # 厂商名</span><br><span class="line">77     product_id diskthr  # 型号</span><br><span class="line">78 &lt;/target&gt;</span><br></pre></td></tr></table></figure><pre><code>3.启服务/ 看端口进程/etc/init.d/tgtd start [service tgtd start]chkconfig tgtd onnetstat -anputl | grep tgtd:32604.显示共享信息</code></pre><p>2.前端应用</p><pre><code>装包63.62yum install -y httpdservice httpd start chkconfig httpd onyum install -y iscsi-initiator-utils发现设备iscsiadm -m discovery -t sendtargets -p 192.168.4.64:3260正在启动 iscsid：                                          [确定]192.168.4.64:3260,1 iqn.2018-04.cn.tedu:rh64.diskb192.168.4.64:3260,1 iqn.2018-04.cn.tedu:rh64.diskc登入设备[挂载]&gt; iscsiadm -m node -T iqn名称 -p ip:port -liscsiadm -m node -T iqn.2018-04.cn.tedu:rh64.diskb -p 192.168.4.64:3260 -liscsiadm -m node -T iqn.2018-04.cn.tedu:rh64.diskc -p 192.168.4.64:3260 -l登出设备[卸载]&gt; iscsiadm -m node -T iqn名称 -p ip:port -uiscsiadm -m node -T iqn.2018-04.cn.tedu:rh64.diskb -p 192.168.4.64:3260 -uiscsiadm -m node -T iqn.2018-04.cn.tedu:rh64.diskc -p 192.168.4.64:3260 -u查看设备 ls /dev/sd*</code></pre><h2 id="UDEV"><a href="#UDEV" class="headerlink" title="UDEV"></a>UDEV</h2><p>前言：由于系统挂载命名是按挂载顺序决定，登出后再登入不能保证是原先的盘符号，造成数据的不稳定<br>[ 默认情况下，硬件命名，是由内核决定的，内核会根据设备的类型和发现的先后顺序给硬件设备定义名称 ]<br>IDE /dev/vda b…<br>SCSI /dev/sda b…<br>于是 UDEV程序可以给内核识别的设备定义名称：<br>        获取系统已经识别的设备的硬件参数，根据参数定义，设备名称。</p><h3 id="获取系统已识别硬件："><a href="#获取系统已识别硬件：" class="headerlink" title="获取系统已识别硬件："></a>获取系统已识别硬件：</h3><p>]# udevadm –help<br>]# udevadm info –query=path –name=内核设备的设别名称<br>]# udevadm info –path=内核设备的设备路径 –attribute-walk</p><p>]# udevadm info –query=path –name=/dev/sda<br>/devices/platform/host2/session1/target2:0:0/2:0:0:1/block/sda<br>]# udevadm info –query=path –name=/dev/sdb<br>/devices/platform/host3/session2/target3:0:0/3:0:0:1/block/sdb</p><p>udevadm info –path=/devices/platform/host3/session2/target3:0:0/3:0:0:1/block/sda –attribute-walk<br>udevadm info –path=/devices/platform/host4/session3/target4:0:0/4:0:0:1/block/sdb –attribute-walk</p><h3 id="配置UDEV"><a href="#配置UDEV" class="headerlink" title="配置UDEV"></a>配置UDEV</h3><p>cd /etc/udev/rules.d/<br>vim 数字-描述信息.rules<br>vim /etc/udev/rules.d/90-iscsidisk.rules<br>SUBSYSTEM==”block”,ATTR{size}==”6291456”,ATTRS{vendor}==”tarena  “,ATTRS{model}==”disktwo         “,SYMLINK+=”iscsi/vdb”<br>SUBSYSTEM==”block”,ATTR{size}==”6291456”,ATTRS{vendor}==”tarena  “,ATTRS{model}==”diskthr         “,SYMLINK+=”iscsi/vdc”<br>:wq</p><p>start_udev # 启动</p><p>ls -l /dev/iscsi/vd*<br>lrwxrwxrwx 1 root root 6 Apr 17 05:41 /dev/iscsi/vdb -&gt; ../sda<br>lrwxrwxrwx 1 root root 6 Apr 17 05:40 /dev/iscsi/vdc -&gt; ../sdb</p><hr><h3 id="格式化-可不分区-一端操作"><a href="#格式化-可不分区-一端操作" class="headerlink" title="格式化,可不分区 [一端操作]"></a>格式化,可不分区 [一端操作]</h3><p>mkfs.ext4 /dev/iscsi/vdb<br>mkfs.ext4 /dev/iscsi/vdc<br>blkid /dev/iscsi/vdb<br>blkid /dev/iscsi/vdc</p><h3 id="挂载到网站根目录-62-63"><a href="#挂载到网站根目录-62-63" class="headerlink" title="挂载到网站根目录 [ 62.63 ]"></a>挂载到网站根目录 [ 62.63 ]</h3><p>mount [-t ext4] /dev/iscsi/vdb /var/www/html/<br>echo LLL &gt; /var/www/html/index.html</p><p>本地文件系统:ext2/3/4：只在本机检查对文件系统的写操作 [同时挂载时不可查看对方新建的文件]<br>全局文件系统:GFS：支持同时对存储设备做写操作</p><h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><p>配置存储服务器192.168.4.65<br>配置：运行NFS服务或samba服务 把本机挂载分区的目录共享给客户端</p><ol><li>给65主机添加的3G新硬盘分一个区 /dev/vdb1 并格式化<br>fdisk -l /dev/sdb<br>fdisk /dev/vdb（一个分区）<br>fdisk -l /dev/vdb</li></ol><p>blkid /dev/vdb1<br>mkfs.ext4 /dev/vdb1<br>blkid /dev/vdb1</p><p>#创建共享文件夹并挂载vbd1 创建共享数据 添加写入权限<br>mkdir /sharedata<br>mount /dev/vdb1 /sharedata<br>cp /etc/hosts /sharedata<br>chmod o+w /sharedata</p><p>#安装配置nfs服务<br>yum install -y rpcbind #为nfs提供数据传输<br>service rpcbind start<br>chkconfig rpcbind on</p><p>yum install -y nfs-utils #nfs共享show :2049<br>vim /etc/exports<br>共享目录        客户端地址(权限)<br>/sharedata      *(rw)<br>service nfs start<br>chkconfig nfs on<br>showmount -e localhost</p><h2 id="客户端挂载nfs"><a href="#客户端挂载nfs" class="headerlink" title="客户端挂载nfs"></a>客户端挂载nfs</h2><p>which showmount<br>rpm -qf /usr/sbin/showmount<br>yum install -y nfs-utils</p><blockquote><p>mount -t 文件类型   ip:/path  localpath<br>mount -t nfs 192.168.4.65:/sharedata /var/www/html<br>echo “web63” &gt;&gt; /var/www/html/index.html</p></blockquote><h2 id="配置ISCSI共享多路径"><a href="#配置ISCSI共享多路径" class="headerlink" title="配置ISCSI共享多路径"></a>配置ISCSI共享多路径</h2><p>yum install -y scsi-target-utils</p><p>vim /etc/tgt/targets.conf<br>62 <target iqn.2018-04.cn.tedu:rh65.diskb=""><br>63     backing-store /dev/vdb<br>64     write-cache off<br>65 </target></p><p>service tgtd start<br>chkconfig tgtd on</p><h4 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h4><p>rpm -qa | rep -i iscsi-initator-utils</p><p>]# iscsiadm -m discovery -t sendtargets -p 192.168.4.65:3260<br>]# iscsiadm -m node -T iqn.2018-04.cn.tedu:rh65.diskb -p 192.168.4.65:3260 -l</p><p>]# iscsiadm -m discovery -t sendtargets -p 192.168.2.65:3260<br>]# iscsiadm -m node -T iqn.2018-04.cn.tedu:rh65.diskb -p 192.168.2.65:3260 -l</p><p>]# ls /dev/sd*</p><p>yum install -y device-mapper-multipath<br>service multipathd status</p><p>3.2获取已经登录iSCSI设备的WWID（全球识别符）<br>scsi_id –whitelisted  –device=磁盘名</p><p>ls /dev/sd*<br>scsi_id –whitelisted –device=/dev/sda<br>1IET     00010001<br>scsi_id –whitelisted –device=/dev/sdb<br>1IET     00010001</p><p>3.3创建多路径服务的配置文件,并用WWID识别设备</p><pre><code>mpathconf --user_friendly_names nls /etc/multipath.confvim /etc/multipath.conf25 defaults {26         user_friendly_names no27         getuid_callout          &quot;/lib/udev/scsi_id --whitelisted --device=/dev/%n&quot; #from37th28 }末行添加multipaths {        multipath {                wwid                    &quot;1IET     00010001&quot;                alias                   mpatha        }}</code></pre><p>3.4 启动多路径服务<br>/etc/init.d/multipathd start<br>chkconfig multipathd on</p><p>3.5 本机验证配置<br>ls /dev/mapper/mpatha</p><p>[root@rh63 ~]# multipath -ll</p><p>重新加载多路径<br>[root@rh63 ~]# ifdown eth1<br>[root@rh63 ~]# multipath -rr<br>[root@rh63 ~]# multipath -ll</p><p>  mkfs.ext4 /dev/mapper/mpatha<br>  mount -t ext4 /dev/mapper/mpatha /var/www/html/</p>]]></content>
      
      
        <tags>
            
            <tag> cluster </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>实战经验分享</title>
      <link href="/2018/04/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB-%E8%AE%BE%E5%A4%87%E9%80%89%E5%9E%8B-%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
      <url>/2018/04/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB-%E8%AE%BE%E5%A4%87%E9%80%89%E5%9E%8B-%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/</url>
      <content type="html"><![CDATA[<p>人称段黄爷的运维大叔XX为我们讲解生产环境中的一些技巧，分享他走过的坎，让我们笑着跨过去…</p><p><img src="https://img-blog.csdn.net/20160916110537866" alt="Linux"></p><a id="more"></a><h1 id="远程管理"><a href="#远程管理" class="headerlink" title="远程管理"></a>远程管理</h1><h2 id="设备选型"><a href="#设备选型" class="headerlink" title="设备选型"></a>设备选型</h2><h3 id="课程设置目的"><a href="#课程设置目的" class="headerlink" title="课程设置目的"></a>课程设置目的</h3><p><em>学到的，就是在企业中正在使用的技术，最终架构和配置均可用于实际生产环境。</em></p><h3 id="服务器选择指标"><a href="#服务器选择指标" class="headerlink" title="服务器选择指标"></a>服务器选择指标</h3><ul><li><p>总体上：</p><ul><li>需求决定一切，着眼未来</li><li>不要贪图便宜，电费远比你想的更贵<br>   机房中空间是稀缺资源，机架式比塔式性价比更高（<em>刀片式服务器太贵，性价比低</em>）    </li><li>管理更方便、比如螺丝少、支持亚远程控制（热插拔硬盘）</li><li>硬件通用性要好、尤其驱动</li><li>厂商支持 【大品牌提供，图便宜自找麻烦】</li><li>可替代产品是否广泛 【主流硬件】</li><li>云主机的性价比很高</li><li>CPU是服务器主要指标的一部分，影响cpu性能的主要指标：缓存、主频、核心数、常用Intel-Xeon</li><li>目前的商用服务器大体可以分为三？类，</li><li>即对称多处理器结构 (SMP)</li><li>非一致存储访问结构 (NUMA)</li></ul></li><li><p>SMP服务器</p><ul><li>主要特征：系统中所有资源（CPU、内存、I/O等）都共享。</li><li>问题：<ul><li>扩展能力有限</li><li>内存共享限制大（随着CPU数量增加，内存访问冲突增加，导致CPU资源浪费、有效性降低）</li></ul></li><li>总结：SMP服务器CPU利用率最好：2-4个CPU</li><li><p>总线型结构</p><p><img src="C:\Users\root\AppData\Local\Temp\1523690800086.png" alt="SMP"></p></li></ul></li><li><p>NUMA服务器</p><ul><li><p>基本特征：具有多个CPU模块，每个模块由多个CPU组成，并且具有独立的本地内存、I/O槽口等</p></li><li><p>由于其节点之间可以通过互联模块进行连接和信息交互，因此每个 CPU 可以访问整个系统的内存，显然访问本地内存的速度远高于访问远地内存的速度，这也是非一致存储访问 NUMA 的由来</p><p><img src="C:\Users\root\AppData\Local\Temp\1523690863793.png" alt="NUMA"></p><p>​</p></li></ul></li><li><p>CPU： </p><ul><li>物理核心数量越多，并发性越强，这里不包括超线程，超线程在 cpu 密集型计算，高负载的时候没有任何效果，甚至还会拖慢系统速度</li><li>cpu 主频越高单次计算速度就越快</li><li>cpu L(1、2、3) 缓存大的性能好</li></ul></li><li><p>内存：</p><ul><li>不同主频的不要混插，按照木桶原理所有内存降频到频率最低的内存标准</li><li>多通道的一定按组接入，多 cpu 的要按组对称分布</li><li>一般主板内存槽同组都会标识相同的颜色，在内存槽边上也有数字连线标识</li></ul></li><li><p>raid：</p><ul><li>raid 卡很总要，总的来说贵的好。</li><li>raid 卡自带内存的，IO 会比较强劲</li><li>raid 卡自带电池的，数据安全性好一点</li><li>raid 既带内存，又带电池的 (好)</li><li>硬 raid 比 软 raid 好</li><li>这个硬是指 raid 卡带数据存储和专用cpu</li><li>主板上的 raid 卡多数靠 cpu 计算，没有专用计算芯片</li><li>raid 级别 0、1、5、6、10</li><li>write back（WB,回写） 性能比 write through（WT，直写） 好</li><li>raid 5 磁盘空间大一些，IO 差强人意不适合做数据库</li><li>raid 10 除了空间浪费多一点整体表现都比 raid5 好</li><li>raid 5 磁盘损坏一块以后会有写惩罚，应该及时更换</li><li>DELL Raid卡：H310 &lt; H710 &lt; H710P = H810[多机柜]</li></ul></li><li><p>硬盘：</p><ul><li>硬盘 15000 转的比 10000 转的好</li><li>做 raid 不能混用</li><li>ssd 也不错，贵的好(Intel 的就不错)</li><li>ssd 尤其在随机 IO 读写上性能非常好</li><li>注意如果选择 SSD：<ul><li>在格式化分区的时候要注意 4K 对齐</li><li>在内核队列上选择 noop 效果比较好[echo ‘noop’&gt;/sys/block/sda/queue/scheduler]</li></ul></li></ul></li><li><p>网卡: 一般主板集成</p></li><li><p>显卡: 在不是专用图像渲染和挖矿的机器上不重要</p></li><li><p>声卡: 有没有都无所谓</p></li><li><p>功耗: 这个要在选配以后大概计算一下，如果选配设备的最大功耗大于电源模块的最大输出就需要考虑配置多个电源了，多个电源有时候不是为了冗余，是因为一个电源根本带不动 ……</p></li><li><p>其他：散热效果是否好，但这个我们可能无能为力</p></li><li><p>广告时间：DELL服务器采用率60%左右，惠普20-30%，国企类多用联想、曙光</p></li></ul><h2 id="XSHELL-机房管理"><a href="#XSHELL-机房管理" class="headerlink" title="XSHELL 机房管理"></a>XSHELL 机房管理</h2><ul><li><p>如何管理机房里面的机器？</p><ol><li>进如机房，连接上显示器，该干嘛干嘛。</li><li>远程使用 ssh<ul><li>ssh 软件 xshell（免费）</li><li>ssh 软件 SecureCRT (收费)</li></ul></li></ol><ul><li>机房的服务器不是全部都有外网地址的。<ul><li>跳板机(堡垒主机)</li><li>VPN [建立加密隧道，相当于专线直连]<br><em>跳板机可以审计，VPN不能</em></li></ul></li></ul></li><li><p>面试应对</p><ul><li>机房里的机器是如何管理的？<ul><li>需要去机房就去机房，一般通过ssh</li></ul></li><li>你们的机器都是能直接ssh连接的吗？<ul><li>我们跳板机进去</li></ul></li><li>怎么安装软件<ul><li>yum</li></ul></li><li>yum 里没有怎么办？<ul><li>做一个扔进去</li></ul></li></ul></li><li><p>Xshell 技巧：</p><ul><li>文件传输xftp命令[ctrl+alt+f]：<ul><li>bye 结束连接</li><li>cd、clear、exit、ls、mkdir、rm 同 shell 命令</li><li>get 下载文件</li><li>put 上传文件</li><li>lcd 选择本地目录</li><li>lls 显示本地目录文件</li><li>lpwd显示本地目录</li></ul></li><li>文件传输zmodem<ul><li>远程服务器装包：yum install -y lrzsz</li><li>上传文件：rz || 直接拖拽到窗口</li><li>下载文件：sz /etc/passwd [指定下载目录或当前目录]</li><li><em>不可传输空文件</em></li></ul></li><li>socks5 隧道 [代理上网]<ul><li>选择远程服务器属性 - 隧道</li><li>选择socks5</li><li>端口</li><li>完成后断开重连</li></ul></li></ul></li></ul><h2 id="IPMI"><a href="#IPMI" class="headerlink" title="IPMI"></a>IPMI</h2><ul><li><p>远程服务器管理问题：</p><ul><li>如果服务器的系统崩溃了怎么办？</li><li>想重新安装系统怎么办？</li><li>想重新做 raid 怎么办？</li><li>系统出现故障，想要救援数据怎么办？</li><li>怎么获得系统，硬盘、raid、内存、CPU的状态 ？</li><li>硬件出现故障怎么能第一时间知道？</li></ul></li><li><p>解决方案——IPMI：<br>  IPMI是为服务器管理设计的一种工业标准。为了解决服务器远程管理标准化，最初由Intel 、HP、Dell、NEC等公司于1998年共同提出。<br>  IPMI标准的推出，使不同产品的集中管理成为可能。<br>  IPMI让用户可以通过网络来监控服务器上各种硬件组件的健康状况，如CPU电压、风扇转速、系统温度、功<br>  耗等。<br>  IPMI 还可以检测电源状态，可以下达开、关机或重启指令。IPMI的核心是基板控制器（BMC），其完全独立于服务器的CPU、BIOS、操作系统、开关机状态之外，是一个完全独立运行的系统。<br>  IPMI 功能通过向 BMC 发送指令完成，指令附合 IPMI规范。很多硬件厂商（DELL、HP、IBM）都提供了服务器带外管理工具。</p><p>  Dell 的 iDrac 工具在不购买远程管理卡的情况下，默认就可以提供，可以实现远程重启服务器，查询服务器状态，温度，文本模式串口终端重定向等等，这些极大的方便了我们远程管理服务器，这种方式的优势就是不依赖于系统，即使在没有开机的情况下，我们依然可以使用大部分功能</p></li><li><p>DELL iDRAC BMC 使用<br>  首先机器进入机房以后我们应该对 iDRAC BMC 进程初始化，配置用户名，密码和管理地址<br>  BMC 出厂默认配置地址 192.168.1.120<br>  BMC 出厂默认用户名 root<br>  BMC 出厂默认密码 calvin<br>  Linux 管理 IPMI 的命令是 ipmitool</p></li><li><p>ipmitool 命令：<br>  ipmitool [ <options> ] <command> [ <sub-commands and="" sub-options=""> ]<br>  常用参数介绍<br>  -U username 登录的用户名<br>  -P password 登录的密码<br>  -H hostname 远程主机地址<br>  power 电源管理模块<br>  sel 硬件日志管理<br>  sol 串口重定向</sub-commands></options></p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> Linux运维 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Nagios</title>
      <link href="/2018/04/Monitor-012-Nagios/"/>
      <url>/2018/04/Monitor-012-Nagios/</url>
      <content type="html"><![CDATA[<p>作为一个运维人员，虽然ssh管理机器很简单，但要无时无刻获取机器的状态显然就比较吃力了，而监控管理就是免除我们需要手动获取机器状态的麻烦。<br>目前比较常用的监控软件有几个：Nagios、Cacti、Zabbix，其中Zabbix应该是比较多使用的，但并不代表Nagios与Cacti就没有用处，本文首先介绍Nagios的安装配置以及使用。</p><a id="more"></a><h1 id="IDC监控"><a href="#IDC监控" class="headerlink" title="IDC监控"></a>IDC监控</h1><ol><li>谈谈你对监控的理解：</li></ol><ul><li>监视并控制，通过监视提前发现故障并把故障解决。</li></ul><ol start="2"><li>监控对象：</li></ol><ul><li>监控公司的各种服务器（网站，数据库）</li></ul><ol start="3"><li>监控服务器的资源：</li></ol><ul><li>网络接口数据流量</li><li>应用服务的运行状态：进程、端口</li><li>服务器硬件资源的使用情况：内存，cpu，磁盘使用情况</li><li>服务器操作系统的运行情况：系统用户数量（系统总用户数，登录系统用户数），系统进程数（总进程，运行进程数，僵尸进程数量）</li></ul><ol start="4"><li>监控手段：</li></ol><p>使用系统提供的命令：</p><ul><li>free -m</li><li>top</li><li>uptime</li><li>df -h</li><li>systemctl status httpd</li><li>ps -C httpd</li><li>netstat -anputl | grep :80</li></ul><p>使用计划任务crond执行自己编写的监控监本（shell/python/perl）</p><p>使用监控软件</p><h2 id="编译安装Nagios："><a href="#编译安装Nagios：" class="headerlink" title="编译安装Nagios："></a>编译安装Nagios：</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++ -y</span><br><span class="line">useradd nagios</span><br><span class="line">groupadd nagcmd</span><br><span class="line">usermod -G nagcmd nagios</span><br><span class="line"><span class="built_in">cd</span> monitor/</span><br><span class="line"><span class="built_in">cd</span> nagios/</span><br><span class="line">tar -xf nagios-4.2.4.tar.gz </span><br><span class="line"><span class="built_in">cd</span> nagios-4.2.4/</span><br><span class="line"><span class="comment"># ./configure --help</span></span><br><span class="line">./configure --with-nagios-user=nagios \</span><br><span class="line">--with-nagios-command-user=nagios \</span><br><span class="line">--with-nagios-command-group=nagcmd \</span><br><span class="line">--with-nagios--group=nagcmd</span><br><span class="line">make all</span><br><span class="line">make install</span><br><span class="line">make install-init</span><br><span class="line">make install-commandmode</span><br><span class="line">make install-config</span><br><span class="line">make install-webconfig</span><br><span class="line">make install-webconf</span><br><span class="line">make install-exfoliation</span><br><span class="line">ls /usr/<span class="built_in">local</span>/nagios</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装监控插件</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">tar -xf nagios-plugins-2.1.4.tar.gz </span><br><span class="line"><span class="built_in">cd</span> nagios-plugins-2.1.4</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ls /usr/<span class="built_in">local</span>/nagios/libexec/check_*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加监控管理用户</span></span><br><span class="line">sed -n <span class="string">"52p"</span> /etc/httpd/conf.d/nagios.conf</span><br><span class="line">    AuthUserFile /usr/<span class="built_in">local</span>/nagios/etc/htpasswd.users</span><br><span class="line">htpasswd -c /usr/<span class="built_in">local</span>/nagios/etc/htpasswd.users nagiosadmin</span><br><span class="line">New passwd:123465</span><br><span class="line"></span><br><span class="line">systemctl restart httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Nagios</span></span><br><span class="line">/etc/init.d/nagios status</span><br><span class="line">No lock file found <span class="keyword">in</span> /usr/<span class="built_in">local</span>/nagios/var/nagios.lock</span><br><span class="line"></span><br><span class="line">/etc/init.d/nagios start</span><br><span class="line">Reloading systemd:                                         [  OK  ]</span><br><span class="line">Starting nagios (via systemctl):                           [  OK  ]</span><br></pre></td></tr></table></figure><h2 id="在客户端访问Nagios-查看监控信息"><a href="#在客户端访问Nagios-查看监控信息" class="headerlink" title="在客户端访问Nagios 查看监控信息"></a>在客户端访问Nagios 查看监控信息</h2><p><em>默认监控本机</em></p><ul><li>已经监控哪些主机 Map</li><li>查看具体监控信息 Host</li><li>查看被监控主机状态</li></ul><h2 id="Nagios-服务的监控过程"><a href="#Nagios-服务的监控过程" class="headerlink" title="Nagios 服务的监控过程"></a>Nagios 服务的监控过程</h2><p><em>监控状态类型</em><br>正常    ok<br>警告    warning<br>错误    critical<br>追加    pending（监控插件正在获取数据）<br>不知道  unknown （监控项配置错误）</p><p>nagios服务运行时，调用监控插件，运维人员可以设置监控插件的阀值（警告值&amp;错误值）被调用的监控插件或自动获取监控数据，把获取的监控数据和设置的监控阀值比较，比较规则：<br>获取到的监控数据 &lt; 警告值  则监控状态为 ok<br>获取到的监控数据 &gt; 警告值 and &lt; 错误值  则监控状态为 Warning<br>获取到的监控数据 &gt; 错误值  则监控状态为 critical</p><h2 id="监控插件的使用"><a href="#监控插件的使用" class="headerlink" title="监控插件的使用"></a>监控插件的使用</h2><p><em>/usr/local/nagios/libexec/</em></p><ul><li>chceck_tcp  连接目标主机的tcp端口号</li><li>chceck_udp  连接目标主机的udp端口号</li><li>nagios服务默认监控本机资源如下：<ul><li>cpu负载           cjeck_load</li><li>登录系统用户数     check_users</li><li>网站服务器状态     check_http</li><li>ping  check_ping</li><li>“/” 分区空闲空间   check_disk</li><li>ssh服务状态        check_ssh</li><li>交换分区使用情况    check_swap</li><li>系统总进程数       check_procs</li></ul></li><li>./check_users –help<ul><li>-w 警告值</li><li>-c 错误值</li></ul></li><li>./check_proces -s R</li><li>./check_disk -w 50% -c 25% /boot</li><li>./check_tcp -H 192.168.4.51 -p 3306</li><li>./check_swap -w 50% -c 80%</li><li>./check_load  -w 0.05,0.20,0.30 -c 0.10,0.25,0.35</li></ul><h2 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h2><p>配置文件位置：/usr/local/nagios/etc/</p><ul><li><p>cgi.cfg CGI程序访问权限定义文件</p><blockquote><p>grep -i nagiosadmin cgi.cfg</p></blockquote></li><li><p>htpasswd.users 存放登录用户的名&amp;密码</p></li><li><p>nagios.cfg 主配置文件，启动服务时加载</p></li><li><p>resource.cfg 宏定义文件（定义变量）<br>  $var$=values</p></li><li><p>objects</p><ul><li>commands.cfg 定义监控命令（设置nagios运行时，可使用的已安装插件）</li><li>contacts.cfg 指定接收监控报警信息邮箱地址的配置文件 <ul><li>#sed -n ‘34p’  contacts.cfg<br>  email       nagios@localhost</li></ul></li><li>localhost.cfg 监控本机的配置文件 </li><li>templates.cfg 定义监控模版的配置文件 </li><li>timeperiods.cfg 定义监控时间模版的配置文件</li><li>windows.cfg</li><li>printer.cfg</li><li>switch.cfg</li></ul></li></ul><h2 id="配置Nagios-nagios-’-usr-local-nagios’"><a href="#配置Nagios-nagios-’-usr-local-nagios’" class="headerlink" title="配置Nagios [nagios=’/usr/local/nagios’]"></a>配置Nagios [nagios=’/usr/local/nagios’]</h2><h3 id="监控远端主机的公有资源（服务）"><a href="#监控远端主机的公有资源（服务）" class="headerlink" title="监控远端主机的公有资源（服务）"></a>监控远端主机的公有资源（服务）</h3><ol><li>创建监控主机的配置件<br> vim /usr/local/nagios/etc/objects/名字.cfg</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nagios/etc/objects/host51.cfg</span><br><span class="line"></span><br><span class="line">define host &#123;</span><br><span class="line">    use     linux-server</span><br><span class="line">    host_name mysql51</span><br><span class="line">    <span class="built_in">alias</span>   host51</span><br><span class="line">    address 192.168.4.51</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######httpd</span></span><br><span class="line">define service&#123;</span><br><span class="line">    use   <span class="built_in">local</span>-service</span><br><span class="line">    host_name mysql51</span><br><span class="line">    service_description web</span><br><span class="line">    check_command check_host51_httpd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######mysql</span></span><br><span class="line">define service&#123;</span><br><span class="line">    use   <span class="built_in">local</span>-service</span><br><span class="line">    host_name mysql51</span><br><span class="line">    service_description mysqld</span><br><span class="line">    check_command check_host51_mysqld</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>定义监控主机使用插件<br> vim $nagios/etc/objects/commands.cfg</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define command&#123;</span><br><span class="line">       command_name    命令名</span><br><span class="line">       command_line    插件名  选项   参数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nagios/etc/objects/commands.cfg</span><br><span class="line">:239</span><br><span class="line"><span class="comment">################my define####################</span></span><br><span class="line"><span class="comment">### monit host 51 web command</span></span><br><span class="line">define <span class="built_in">command</span>&#123;</span><br><span class="line">       command_name check_host51_httpd</span><br><span class="line">       <span class="comment">#command_line /usr/local/nagios/libexec/check_http -H 192.168.4.51 -p 80</span></span><br><span class="line">       command_line <span class="variable">$USER1</span>$/check_http -H 192.168.4.51 -p 80</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">### monit host 51 mysqld command</span></span><br><span class="line">define <span class="built_in">command</span>&#123;</span><br><span class="line">       command_name check_host51_mysqld</span><br><span class="line">       command_line <span class="variable">$USER1</span>$/check_tcp -H 192.168.4.51 -p 3306     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>启动nagios服务时，</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$nagios</span>/etc/nagios.cfg</span><br><span class="line">:34 </span><br><span class="line"><span class="comment"># Definitions for monitoring the local (Linux) host</span></span><br><span class="line">...</span><br><span class="line">cfg_file=/usr/<span class="built_in">local</span>/nagios/etc/objects/host51.cfg</span><br></pre></td></tr></table></figure><ol start="4"><li>验证配置是否正确</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nagios</span>/bin/nagios -v <span class="variable">$nagios</span>/etc/nagios.cfg</span><br><span class="line"></span><br><span class="line">/etc/init.d/nagios restart</span><br></pre></td></tr></table></figure><ol start="5"><li>一键配置脚本</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Host Name: "</span> host</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"IP Address: "</span> ip</span><br><span class="line">nagios=<span class="string">'/usr/local/nagios'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"define host &#123;</span></span><br><span class="line"><span class="string">    use     linux-server</span></span><br><span class="line"><span class="string">    host_name <span class="variable">$host</span></span></span><br><span class="line"><span class="string">    alias   <span class="variable">$host</span></span></span><br><span class="line"><span class="string">    address 192.168.4.<span class="variable">$ip</span></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">#######httpd</span></span><br><span class="line"><span class="string">define service&#123;</span></span><br><span class="line"><span class="string">    use   local-service</span></span><br><span class="line"><span class="string">    host_name <span class="variable">$host</span></span></span><br><span class="line"><span class="string">    service_description web</span></span><br><span class="line"><span class="string">    check_command check_<span class="variable">$&#123;host&#125;</span>_httpd</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">#######mysql</span></span><br><span class="line"><span class="string">define service&#123;</span></span><br><span class="line"><span class="string">    use   local-service</span></span><br><span class="line"><span class="string">    host_name <span class="variable">$host</span></span></span><br><span class="line"><span class="string">    service_description mysqld</span></span><br><span class="line"><span class="string">    check_command check_<span class="variable">$&#123;host&#125;</span>_mysqld</span></span><br><span class="line"><span class="string">&#125;"</span> &gt; <span class="variable">$nagios</span>/etc/objects/<span class="variable">$&#123;host&#125;</span>.cfg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"### monit host <span class="variable">$ip</span> web command</span></span><br><span class="line"><span class="string">define command&#123;</span></span><br><span class="line"><span class="string">       command_name check_<span class="variable">$&#123;host&#125;</span>_httpd</span></span><br><span class="line"><span class="string">       command_line \$USER1$/check_http -H 192.168.4.<span class="variable">$ip</span> -p 80</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### monit host <span class="variable">$ip</span> mysqld command</span></span><br><span class="line"><span class="string">define command&#123;</span></span><br><span class="line"><span class="string">       command_name check_<span class="variable">$&#123;host&#125;</span>_mysqld</span></span><br><span class="line"><span class="string">       command_line \$USER1$/check_tcp -H 192.168.4.<span class="variable">$ip</span> -p 3306</span></span><br><span class="line"><span class="string">&#125;"</span> &gt;&gt; /usr/<span class="built_in">local</span>/nagios/etc/objects/commands.cfg</span><br><span class="line">vim <span class="variable">$nagios</span>/etc/nagios.cfg +35</span><br><span class="line"><span class="variable">$nagios</span>/bin/nagios -v <span class="variable">$nagios</span>/etc/nagios.cfg</span><br><span class="line">/etc/init.d/nagios restart</span><br></pre></td></tr></table></figure><h3 id="监控远端主机的私有资源（系统运行情况）"><a href="#监控远端主机的私有资源（系统运行情况）" class="headerlink" title="监控远端主机的私有资源（系统运行情况）"></a>监控远端主机的私有资源（系统运行情况）</h3><ol><li>配置客户端（被监控的主机192.168.4.51）<ul><li>安装监控插件</li></ul></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xf nagios-plugins-2.1.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nagios-plugins-2.1.4/</span><br><span class="line">./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line">useradd nagios</span><br></pre></td></tr></table></figure><ul><li>运行nrpe服务</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">tar -xf nrpe-3.0.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nrpe-3.0.1</span><br><span class="line">./configure</span><br><span class="line">make all</span><br><span class="line">make --<span class="built_in">help</span></span><br><span class="line">make install-daemon <span class="comment">#服务守护进程</span></span><br><span class="line">make install-config <span class="comment">#配置文件</span></span><br><span class="line">ls /usr/<span class="built_in">local</span>/nagios/etc/nrpe.cfg</span><br><span class="line">make install-init   <span class="comment">#启动脚本</span></span><br><span class="line">make install-plugin <span class="comment">#连接nrpe服务插件</span></span><br><span class="line">ls /usr/<span class="built_in">local</span>/nagios/libexec/check_nrpe</span><br><span class="line"></span><br><span class="line">vim /usr/<span class="built_in">local</span>/nagios/etc/nrpe.cfg</span><br><span class="line">:98</span><br><span class="line">allowed_hosts=127.0.0.1, 192.168.4.57 <span class="comment"># 添加监控服务器ip</span></span><br><span class="line">:287</span><br><span class="line"><span class="built_in">command</span>[命令名]=/usr/<span class="built_in">local</span>/nagios/libexec/插件名 选项 参数</span><br><span class="line"><span class="built_in">command</span>[nrpe_mon_51_user]=/usr/<span class="built_in">local</span>/nagios/libexec/check_users -w 1 -c 2</span><br><span class="line"></span><br><span class="line">systemctl start nrpe <span class="comment">#启动服务</span></span><br><span class="line">netstat -anput | grep :5666</span><br></pre></td></tr></table></figure><ul><li>测试nrpe服务</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nagios</span>/libexec/check_nrpe -H 127.0.0.1 -p5666 -c nrpe_mon_51_user</span><br></pre></td></tr></table></figure><ol start="2"><li>配置监控服务器（192.168.4.57）<ul><li>安装连接nrpe服务的插件</li><li>定义监控命令</li><li>在监控主机配置文件里调用监控命令</li><li>启动nagios服务时，加载监控主机的配置文件</li><li>验证配置</li><li>重启nagios服务</li></ul></li></ol>]]></content>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-03-mine</title>
      <link href="/2018/04/Security-03_mine/"/>
      <url>/2018/04/Security-03_mine/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">52做邮件主机</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl stop &amp;&amp; <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line">rpm -qa postfix || yum -y install postfix</span><br><span class="line">vim /etc/postfix/main.cf</span><br><span class="line">113 inet</span><br><span class="line">116 <span class="comment">#inet</span></span><br><span class="line">419 home_mailbox = Maildir/   //一个邮件一个文件</span><br><span class="line"></span><br><span class="line">systemctl restart postfix</span><br><span class="line">systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">netstat -anput | grep :25</span><br><span class="line"></span><br><span class="line">vim /etc/host</span><br><span class="line">    12.0.0.1    mail.tedu.cn    localhost...</span><br><span class="line">useradd bob</span><br><span class="line">useradd tony</span><br><span class="line"><span class="built_in">echo</span> 123456 | passwd --stdin bob</span><br><span class="line"><span class="built_in">echo</span> 123456 | passwd --stdin tony</span><br><span class="line"></span><br><span class="line">pc254:</span><br><span class="line"><span class="built_in">which</span> telnet</span><br><span class="line">yum  install -y telnet</span><br><span class="line"></span><br><span class="line">telent 192.168.4.52 25</span><br><span class="line">helo pc254 定义自己的主机名</span><br><span class="line">mail from:bob@tedu.cn 指定发件人</span><br><span class="line">prct to:tony@tedu.cn 指定收件人</span><br><span class="line">data</span><br><span class="line">内容</span><br><span class="line">.</span><br><span class="line">quit</span><br><span class="line">-----dovecot邮件接收-------</span><br><span class="line">yum install -y dovecot</span><br><span class="line">ls /etc/dovecot</span><br><span class="line"></span><br><span class="line">vim /etc/dovecot/10-mail.conf</span><br><span class="line">&gt; 24 mail_location = maildir:~/Maildir</span><br><span class="line">vim /etc/dovecot/10-auth.conf</span><br><span class="line">&gt; 10 disable_plaintext_auth = no</span><br><span class="line"></span><br><span class="line">systemctl start dovecot</span><br><span class="line">systemctl <span class="built_in">enable</span> dovecot</span><br><span class="line">netstat -anput | grep dovecot</span><br><span class="line"></span><br><span class="line">在邮件服务器本纪测试收邮件服务dovecot的配置</span><br><span class="line">yum install -y telnet</span><br><span class="line">telnet localhost 110    //连接本机dovecot服务</span><br><span class="line">user tony   //登录邮箱用户名</span><br><span class="line">pass 123456</span><br><span class="line">list    //查看邮件列表</span><br><span class="line">retr 编号   //查看邮件内容</span><br><span class="line">quit    //断开连接</span><br><span class="line"></span><br><span class="line">-------------------CA SERVER-----------------</span><br><span class="line">CA?</span><br><span class="line">PKI?</span><br><span class="line"></span><br><span class="line">Build:</span><br><span class="line">Server55:</span><br><span class="line">创建私钥</span><br><span class="line">创建根证书</span><br><span class="line">共享根证书</span><br><span class="line"></span><br><span class="line">vim /etc/pki/tls/openssl.cnf</span><br><span class="line">40  [ CA_default ] <span class="comment"># 默认环境</span></span><br><span class="line">42  dir                   = /etc/pki/CA</span><br><span class="line">45  database         =<span class="variable">$dir</span>/index.txt                 <span class="comment">#索引文件</span></span><br><span class="line">50  certificate        = <span class="variable">$dir</span>/my-ca.crt              <span class="comment">#根证书文件</span></span><br><span class="line">51  serial               = <span class="variable">$dir</span>/serial                      <span class="comment">#证书编号文件</span></span><br><span class="line">55  private_key     = <span class="variable">$dir</span>/private/my-ca.key  <span class="comment">#私钥文件</span></span><br><span class="line"></span><br><span class="line">128 [ req_distinguished_name ] <span class="comment"># 证书识别</span></span><br><span class="line">130 countryName_default             = CN</span><br><span class="line">135 stateOrProvinceName_default     = Guangdong</span><br><span class="line">138 localityName_default            = Guangzhou</span><br><span class="line">141 0.organizationName_default      = Tedu Technology Ltd</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line"><span class="built_in">echo</span> 01 &gt; /etc/pki/CA/serial</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/pki/CA/private</span><br><span class="line">openssl genrsa -des3 2048 &gt; my-ca.key  <span class="comment">#(password：123456)</span></span><br><span class="line">chmod 600 my-ca.key</span><br><span class="line">openssl req -new -x509 -key my-ca.key -days 365 &gt; ../my-ca.crt</span><br><span class="line"></span><br><span class="line"><span class="comment">#openssl命令做数据加密解密</span></span><br><span class="line"><span class="comment">#openssl enc -des3 -e -in f1.txt -out f1.txt.enc</span></span><br><span class="line"><span class="comment">#openssl enc -des3 -d -in f1.txt.enc -out f1.txt</span></span><br><span class="line">-----------&gt;&gt;</span><br><span class="line">发布证书</span><br><span class="line">mkdir /var/www/html/cadir</span><br><span class="line">cp /etc/pki/CA/my-ca.crt /var/www/html/cadir</span><br><span class="line">chmod +r /var/www/html/cadir/my-ca.crt</span><br><span class="line">systemctl restart httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br><span class="line"></span><br><span class="line">----------Mail -encrypt -------------</span><br><span class="line">setup:</span><br><span class="line">1.create private key file</span><br><span class="line">2.create ceritified file request file and sent to CA server</span><br><span class="line">3.证书下发后，部署postfix服务器和dovecot服务器</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-03-nmap</title>
      <link href="/2018/04/Security-03-nmap/"/>
      <url>/2018/04/Security-03-nmap/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">-----------------nmap-----------------------</span><br><span class="line"></span><br><span class="line">yum install -y nmap</span><br><span class="line">man nmap</span><br><span class="line">nmap [扫描方式] [选项] &lt;ip address&gt;</span><br><span class="line">扫描方式：</span><br><span class="line">-sS ，TCP SYN扫描（半开）</span><br><span class="line">-sT  ，TCP连接扫描（全开）</span><br><span class="line">-sU ， UDP扫描</span><br><span class="line">-sP ， ICMP扫描</span><br><span class="line">-A ， 目标系统全面分析</span><br><span class="line"></span><br><span class="line">选项</span><br><span class="line">-n , 不解析域名 加快扫描</span><br><span class="line">-p port ,端口</span><br><span class="line">ip： 176.121.0.1； 176.121.0.1-10 ； 176.121.0.1,3,5 ；176.121.0.0/24</span><br><span class="line"></span><br><span class="line">-------------------tcpdump------------------</span><br><span class="line"></span><br><span class="line">tcpdump:提取tcp数据的命令行工具</span><br><span class="line"></span><br><span class="line">格式：tcpdump [选项] [过滤条件]</span><br><span class="line">默认只抓取从eth0</span><br><span class="line">选项：</span><br><span class="line">-i 网卡接口</span><br><span class="line">-A ASII</span><br><span class="line">-w 写入文件</span><br><span class="line">-r 读取数据包</span><br><span class="line">-c 数字 抓包个数</span><br><span class="line"></span><br><span class="line">过滤条件：</span><br><span class="line">类型= host、net、port、portrange</span><br><span class="line">方向= src、dst</span><br><span class="line">协议=tcp、udp、ip、wlan、arp.......</span><br><span class="line">多个条件组合=and、or、not</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-03</title>
      <link href="/2018/04/Security-03/"/>
      <url>/2018/04/Security-03/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line">day03</span><br><span class="line">一 搭建CA服务器</span><br><span class="line">1.1 CA 介绍？</span><br><span class="line">1.2 PKI ?</span><br><span class="line">1.3 架设CA服务器192.168.4.55   caplj.ca.cn</span><br><span class="line">1 配置CA签署环境</span><br><span class="line">2 给CA服务器创建私钥文件</span><br><span class="line">3 给CA服务器创建根证书文件</span><br><span class="line">4 ca服务器共享根证书文件给客户端主机</span><br><span class="line"></span><br><span class="line">]<span class="comment">#rpm -qf /etc/pki/tls/openssl.cnf</span></span><br><span class="line">]<span class="comment">#vim   /etc/pki/tls/openssl.cnf</span></span><br><span class="line">40 [ CA_default ]</span><br><span class="line">42 dir             = /etc/pki/CA</span><br><span class="line">45 database        = <span class="variable">$dir</span>/index.txt  <span class="comment">#索引文件</span></span><br><span class="line">50 certificate     = <span class="variable">$dir</span>/my-ca.crt   <span class="comment">#根证书文件名</span></span><br><span class="line">51 serial          = <span class="variable">$dir</span>/serial            <span class="comment">#证书编号文件</span></span><br><span class="line">55 private_key     = <span class="variable">$dir</span>/private/my-ca.key <span class="comment">#私钥文件名</span></span><br><span class="line"></span><br><span class="line">128 [ req_distinguished_name ]</span><br><span class="line">130 countryName_default             = CN  国家</span><br><span class="line">135 stateOrProvinceName_default     = beijing  省</span><br><span class="line">138 localityName_default            = beijing  城市</span><br><span class="line">141 0.organizationName_default      = tarena  公司名</span><br><span class="line">148 organizationalUnitName_default  = ope   部门名</span><br><span class="line"></span><br><span class="line"> 84 [ policy_match ]</span><br><span class="line"> 85 countryName             = match   国家</span><br><span class="line"> 86 stateOrProvinceName     = match  省</span><br><span class="line"> 87 organizationName        = match  公司</span><br><span class="line"> 88 organizationalUnitName  = optional</span><br><span class="line"> 89 commonName              = supplied</span><br><span class="line"> 90 emailAddress            = optional</span><br><span class="line">：wq</span><br><span class="line">]<span class="comment"># touch /etc/pki/CA/index.txt</span></span><br><span class="line">]<span class="comment"># echo 01 &gt;  /etc/pki/CA/serial</span></span><br><span class="line"></span><br><span class="line">]<span class="comment">#cd  /etc/pki/CA/private</span></span><br><span class="line">]<span class="comment">#openssl  genrsa  -des3  2048  &gt;  my-ca.key (密码123456)</span></span><br><span class="line">]<span class="comment"># chmod 600 my-ca.key</span></span><br><span class="line">]<span class="comment">#openssl  req  -new  -x509  -key my-ca.key  -days 365  &gt;  ../my-ca.crt</span></span><br><span class="line"></span><br><span class="line">[root@caplj prte]<span class="comment"># openssl  req  -new  -x509  -key my-ca.key  -days 365 &gt; ../my-ca.crt</span></span><br><span class="line">Enter pass phrase <span class="keyword">for</span> my-ca.key: 输私钥的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [CN]:  国家默认</span><br><span class="line">State or Province Name (full name) [beijing]: 省默认</span><br><span class="line">Locality Name (eg, city) [beijing]: 城市默认</span><br><span class="line">Organization Name (eg, company) [tarena]:公司名默认</span><br><span class="line">Organizational Unit Name (eg, section) [ope]: 部门名默认</span><br><span class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:caplj.ca.cn  #填写ca服务器的主机名</span></span><br><span class="line"><span class="string">Email Address []:plj@163.com  #填写工作邮箱</span></span><br><span class="line"><span class="string">[root@caplj private]#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  148  yum -y install httpd</span></span><br><span class="line"><span class="string">  149  mkdir /var/www/html/cadir</span></span><br><span class="line"><span class="string">  150  cp /etc/pki/CA/my-ca.crt  /var/www/html/cadir/</span></span><br><span class="line"><span class="string">  151  chmod +r /var/www/html/cadir/my-ca.crt</span></span><br><span class="line"><span class="string">  152  systemctl  start httpd ; systemctl  enable httpd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@caplj ~]# ls /var/www/html/cadir/</span></span><br><span class="line"><span class="string">my-ca.crt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">在客户端打开浏览器访问55主机的网站服务下载共享的根证书文件</span></span><br><span class="line"><span class="string">http://192.168.4.55/cadir</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">客户端主机安装根证书文件？</span></span><br><span class="line"><span class="string">安装</span></span><br><span class="line"><span class="string">删除</span></span><br><span class="line"><span class="string">查看安装哪些CA机构的根证书文件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">openssl命令做数据加密解密</span></span><br><span class="line"><span class="string">]#openssl  enc  -des3   -e  -in  f1.txt  -out  f1.txt.enc</span></span><br><span class="line"><span class="string">]#openssl  enc  -des3  -d  -in  f1.txt.enc  -out  f1.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">二 邮件加密</span></span><br><span class="line"><span class="string">2.1 邮件服务器的配置</span></span><br><span class="line"><span class="string">1 创建私钥文件</span></span><br><span class="line"><span class="string">2 创建证书请求文件 并把文件传给CA服务器</span></span><br><span class="line"><span class="string">3 邮件服务器接收到下发的数字证书后，部署postfix 服务和dovecot服务运行时调用私钥文件和数字证书文件</span></span><br><span class="line"><span class="string">4 重启服务</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]#cd  /etc/pki/tls/private/</span></span><br><span class="line"><span class="string">]#openssl  genrsa  2048  &gt;  mail.key</span></span><br><span class="line"><span class="string">]#cat mail.key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">]#openssl  req  -new  -key  mail.key  &gt;   /root/mail.csr</span></span><br><span class="line"><span class="string">Country Name (2 letter code) [XX]:CN</span></span><br><span class="line"><span class="string">State or Province Name (full name) []:beijing</span></span><br><span class="line"><span class="string">Locality Name (eg, city) [Default City]:beijing</span></span><br><span class="line"><span class="string">Organization Name (eg, company) [Default Company Ltd]:tarena</span></span><br><span class="line"><span class="string">Organizational Unit Name (eg, section) []:ope</span></span><br><span class="line"><span class="string">Common Name (eg, your name or your server'</span>s hostname) []:mail.ca.cn</span><br><span class="line">Email Address []:amdin@163.com</span><br><span class="line"></span><br><span class="line">Please enter the following <span class="string">'extra'</span> attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line">]<span class="comment">#cat  /root/mail.csr</span></span><br><span class="line">]<span class="comment">#scp /root/mail.csr   192.168.4.55:/tmp/</span></span><br><span class="line"></span><br><span class="line">2.2 CA服务器的配置</span><br><span class="line">1 审核并签发数字证书文件</span><br><span class="line">2 下发数字证书文件给邮件服务器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">]<span class="comment">#cd /etc/pki/CA/certs</span></span><br><span class="line">]<span class="comment">#openssl   ca  -in  /tmp/mail.csr   &gt;    mail.crt  (需要输入私钥密码)</span></span><br><span class="line">]<span class="comment">#scp mail.crt  192.168.4.52:/tmp/</span></span><br><span class="line"></span><br><span class="line">3 邮件服务器接收到下发的数字证书后，部署postfix 服务和dovecot服务运行时调用私钥文件和数字证书文件</span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/dovecot/conf.d/10-ssl.conf</span></span><br><span class="line"> 14 ssl_cert = &lt;/etc/pki/dovecot/certs/mail.crt   <span class="comment">#数字证书</span></span><br><span class="line"> 15 ssl_key = &lt;/etc/pki/dovecot/private/mail.key <span class="comment">#私钥</span></span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">]<span class="comment"># cp /tmp/mail.crt  /etc/pki/dovecot/certs/</span></span><br><span class="line">]<span class="comment"># cp /etc/pki/tls/private/mail.key /etc/pki/dovecot/private/</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/postfix/main.cf(在文件末尾添加如下行)</span></span><br><span class="line">smtpd_use_tls = yes<span class="comment">#smtpd_tls_auth_only = yes</span></span><br><span class="line">smtpd_tls_key_file = /etc/pki/tls/private/mail.key</span><br><span class="line">  <span class="comment">#私钥</span></span><br><span class="line">smtpd_tls_cert_file = /etc/pki/tls/certs/mail.crt  <span class="comment">#数字证书:wq</span></span><br><span class="line">]<span class="comment"># cp /tmp/mail.crt  /etc/pki/tls/certs/</span></span><br><span class="line"></span><br><span class="line">4 重启服务</span><br><span class="line">]<span class="comment">#systemctl  restart  dovecot</span></span><br><span class="line">]<span class="comment">#systemctl  restart  postfix</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"></span><br><span class="line">客户端在软件里设置连接邮件服务器时，访问邮件服务器的加密端口。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">课后练习：配置网站加密</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">52 主机做邮件服务器（提供发邮件服务 postfix 和提供收邮件dovecot）</span><br><span class="line">]<span class="comment"># setenforce   0</span></span><br><span class="line">]<span class="comment"># systemctl  stop  firewalld</span></span><br><span class="line">]<span class="comment"># systemctl  disable  firewalld</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># rpm  -q  postfix  ||  yum  -y  install postfix</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/postfix/main.cf</span></span><br><span class="line">113 inet_interfaces = all</span><br><span class="line">116 <span class="comment">#inet_interfaces = localhost</span></span><br><span class="line">419 home_mailbox = Maildir/</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">[root@db2 ~]<span class="comment"># systemctl  restart  postfix</span></span><br><span class="line">[root@db2 ~]<span class="comment"># systemctl  enable  postfix</span></span><br><span class="line">[root@db2 ~]<span class="comment"># netstat  -utnalp  | grep  :25</span></span><br><span class="line">[root@db2 ~]<span class="comment"># hostname  mail.ca.cn</span></span><br><span class="line"></span><br><span class="line">]<span class="comment">#vim /etc/hosts</span></span><br><span class="line">127.0.0.1    mail.ca.cn   localhost  .....</span><br><span class="line"></span><br><span class="line">useradd  bob</span><br><span class="line">useradd  tony</span><br><span class="line"><span class="built_in">echo</span> 123456 |  passwd --stdin  bob</span><br><span class="line"><span class="built_in">echo</span> 123456 |  passwd --stdin  tony</span><br><span class="line"></span><br><span class="line">邮箱地址                      登录邮箱的密码</span><br><span class="line">bob@mail.ca.cn    123456</span><br><span class="line">tony@mail.ca.cn   123456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在客户端使用命令工具测试52主机是否能够发送邮件</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl  stop  firewalld</span><br><span class="line">ping  -c   2   192.168.4.52</span><br><span class="line"><span class="built_in">which</span>  telnet</span><br><span class="line">yum  -y  install telnet</span><br><span class="line">]<span class="comment">#telnet   192.168.4.52   25</span></span><br><span class="line">helo  pc254  定义自己的主机名</span><br><span class="line">mail  from:bob@mail.ca.cn   指定发件人</span><br><span class="line">rcpt to:tony@mail.ca.cn 指定收件人</span><br><span class="line">data编写邮件正文</span><br><span class="line">xxxxx</span><br><span class="line">xxxxxx</span><br><span class="line">xxxxxx  邮件内容</span><br><span class="line">.       提交邮件</span><br><span class="line">quit 断开连接</span><br><span class="line"></span><br><span class="line">[root@room9pc17 ~]<span class="comment"># telnet 192.168.4.52  25</span></span><br><span class="line">Trying 192.168.4.52...</span><br><span class="line">Connected to 192.168.4.52.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">220 db2.localdomain ESMTP Postfix</span><br><span class="line">helo pc254</span><br><span class="line">250 db2.localdomain</span><br><span class="line">mail from:bob@localhost</span><br><span class="line">250 2.1.0 Ok</span><br><span class="line">rcpt to:tony@localhost</span><br><span class="line">250 2.1.5 Ok</span><br><span class="line">data</span><br><span class="line">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span><br><span class="line">my love boy</span><br><span class="line">my love boy</span><br><span class="line">.</span><br><span class="line">250 2.0.0 Ok: queued as 1F08D8B709FD</span><br><span class="line">quit</span><br><span class="line">221 2.0.0 Bye</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line"></span><br><span class="line">在邮件服务器52上查看邮件是否投递成功</span><br><span class="line"><span class="comment"># ls  /home/tony/Maildir/new/</span></span><br><span class="line"><span class="comment"># cat /home/tony/Maildir/new/1523354538.Vfd02I8012c25M88521.db2</span></span><br><span class="line"></span><br><span class="line">配置收邮件的服务dovecot</span><br><span class="line">rpm  -q  dovecot   ||  yum  -y  install  dovecot</span><br><span class="line">]<span class="comment"># ls /etc/dovecot/conf.d/</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/dovecot/conf.d/10-mail.conf</span></span><br><span class="line">24 mail_location = maildir:~/Maildir</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/dovecot/conf.d/10-auth.conf</span></span><br><span class="line">10 disable_plaintext_auth = no</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">]<span class="comment"># systemctl  start  dovecot</span></span><br><span class="line">]<span class="comment"># systemctl  enable  dovecot</span></span><br><span class="line"></span><br><span class="line">]<span class="comment">#netstat  -utnalp  | grep  dovecot</span></span><br><span class="line"></span><br><span class="line">在邮件服务器本机测试收邮件服务dovecot的配置</span><br><span class="line">]<span class="comment">#yum  -y   install  telnet</span></span><br><span class="line">telnet   localhost  110    //连接本机dovecot 服务</span><br><span class="line">user   tony            //登录邮箱的用户名</span><br><span class="line">pass   123456       //登录邮箱密码</span><br><span class="line">list                        //查看邮件列表</span><br><span class="line">retr  编号              //查看某一封邮件内容</span><br><span class="line">quit          //断开连接</span><br><span class="line">+++++++++++++++++++++++++++++++++++</span><br><span class="line">每种文件要存储在哪些目录下？</span><br><span class="line">所有的文件都是使用openssl命令创建。</span><br><span class="line"></span><br><span class="line">根证书文件（只有CA服务器有）</span><br><span class="line">私钥文件 （邮件服务器和CA服务器都有各自的私钥文件）</span><br><span class="line">证书请求文件（邮件服务器要使用自己的私钥创建）</span><br><span class="line">数字证书文件（是CA服务器使用自己的私钥签发的）</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-02-Encryption</title>
      <link href="/2018/04/Security-02-Encryption/"/>
      <url>/2018/04/Security-02-Encryption/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><h1 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h1><ul><li><p>确保数据的机密性</p><pre><code>- 对称加密：加密/解密用同一个密钥:- DES,Data Encryption Standard- AES,Advanced Encryption Standard- 非对称加密：加密/解密用不同密钥（公钥、私钥）:- RSA,Rivest Shamirh Adleman- DSA,Digital Signature Alorithm</code></pre><!--more---></li><li><p>保护信息的完整性</p><pre><code>-  Hash散列技术，用于信息摘要：基于输入的信息生成长度较短、位数固定的散列值  - MD5,Message Digest Alorithm 5  - SHA,Secure Hash Algorithm</code></pre></li></ul><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p><em>环境准备 :</em></p><p>useradd userA | B<br>echo 123456 | passwd –stdin userA | B<br>登录方式：ssh -X userA | B @localhost</p><h2 id="对称加密及解密"><a href="#对称加密及解密" class="headerlink" title="对称加密及解密-"></a>对称加密及解密-</h2><p>-c 加密<br>-d 解密<br>userA ——&gt; userB<br>发———— 收</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">userA:</span><br><span class="line">gpg -c a.txt（输入加密口令）</span><br><span class="line">mv a.txt.gpg /tmp ; md5sum a.txt.gpg</span><br><span class="line"></span><br><span class="line">userB:</span><br><span class="line">gpg -d /tmp/a.txt.gpg &gt; ~/test.txt (输入解密口令)</span><br><span class="line"> cat ~/test.txt ; md5sum ~/test.txt</span><br></pre></td></tr></table></figure><h2 id="非对称加密解密"><a href="#非对称加密解密" class="headerlink" title="非对称加密解密-"></a>非对称加密解密-</h2><p>–gen-key 创建密钥对<br>-e 加密<br>-d 解密<br>-a –export 导出公钥<br>–import 导入公钥</p><p>userA ——&gt; userB<br>发————收<br>加———— 解<br>公钥———- 私钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/test.txt bs=1M count=100000(nothing)</span><br><span class="line"></span><br><span class="line">userB：</span><br><span class="line"><span class="comment"># rm -rf ~/.gnupg</span></span><br><span class="line">1.创建密钥对</span><br><span class="line"><span class="comment"># gpg --gen-key ; ls ~/.gnupg/</span></span><br><span class="line">2.导出公钥发送</span><br><span class="line"><span class="comment"># gpg -a --export ; gpg -a --export &gt; /tmp/userB.pub</span></span><br><span class="line"></span><br><span class="line">userA:</span><br><span class="line"> <span class="comment"># rm -rf ~/.gnupg</span></span><br><span class="line">1.导入公钥</span><br><span class="line"><span class="comment"># gpg --import /tmp/userB.pub ; ls ~/.gnupg/</span></span><br><span class="line">2.使用公钥加密文件</span><br><span class="line"><span class="comment"># gpg -e -r zhangzhi a.txt</span></span><br></pre></td></tr></table></figure><h2 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h2><p>签名作用：验证文件完整性 实现不可否认性<br>使用私钥签名<br>使用公钥验证签名<br>-b 创建签名文件<br>–verify 验证签名文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">userB使用私钥创建签名文件</span><br><span class="line">head -4 /etc/passwd &gt; c.txt</span><br><span class="line">cat c.txt</span><br><span class="line">gpg -b c.txt //创建签名文件 会自动调用自己的私钥做签名</span><br><span class="line">ls c.txt.sig</span><br><span class="line">mv c.txt* /tmp/</span><br><span class="line">gpg --fingerprint</span><br><span class="line"></span><br><span class="line">userA使用导入的B的公钥验证签名文件</span><br><span class="line">cat /tmp/c.txt</span><br><span class="line">gpg --verify /tmp/c.txt.sig(文件内容和签名时一样 提示验证完好 反之提示损坏)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-02-SELINUX</title>
      <link href="/2018/04/Security-02-Selinux/"/>
      <url>/2018/04/Security-02-Selinux/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">移动文件：保持原有的访问类型不变</span><br><span class="line">复制文件：继承目标目录的安全上下文</span><br><span class="line"></span><br><span class="line">1.6.5 修改文件的安全上下文</span><br><span class="line">chcon -t 访问类型 文件名    //修改单个文件</span><br><span class="line">chcon -R -t 访问类型 目录名 //递归修改</span><br><span class="line"></span><br><span class="line">1.6.6 恢复文件的安全上下文</span><br><span class="line">restorecon 文件名 //恢复单个文件</span><br><span class="line">restorecon -R 目录名 //恢复整个目录</span><br><span class="line"></span><br><span class="line">1.6.7 修改selinux布尔值（功能开关）</span><br><span class="line">查看布尔值</span><br><span class="line">getsebool -a</span><br><span class="line">getsebool -a | grep -i 服务名</span><br><span class="line"></span><br><span class="line">修改布尔值</span><br><span class="line">setsebool -P 变量名 on | off</span><br><span class="line">setsebool -P 变量名=1|0</span><br><span class="line"></span><br><span class="line">修改相关bool值允许匿名用户上传文件</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-02</title>
      <link href="/2018/04/Security-02/"/>
      <url>/2018/04/Security-02/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line">day02</span><br><span class="line">SElinux安全防护</span><br><span class="line">数据加密与解密</span><br><span class="line">扫描</span><br><span class="line">抓包</span><br><span class="line">协议分析软件的使用</span><br><span class="line"></span><br><span class="line">一、SElinux安全防护</span><br><span class="line">1.1 linux安全防护模式？ DAC   和 MAC</span><br><span class="line">1.2  SElinux介绍</span><br><span class="line">       selinux 保护的方式：多级别保护 MLS  和</span><br><span class="line">                                        只保护常用的服务targeted</span><br><span class="line">1.3  查看操作系统当前selinux的状态  ]<span class="comment">#sestatus</span></span><br><span class="line">       [root@db51 ~]<span class="comment"># getenforce</span></span><br><span class="line">       Permissive</span><br><span class="line"></span><br><span class="line">1.4 临时启动和禁用selinux</span><br><span class="line"><span class="comment"># setenforce   1</span></span><br><span class="line"><span class="comment"># setenforce   0</span></span><br><span class="line"></span><br><span class="line">1.5  永久启用或禁用selinux</span><br><span class="line"><span class="comment"># vim /etc/selinux/config</span></span><br><span class="line">enforcing   &lt;------ permissive  -------&gt; disabled</span><br><span class="line"></span><br><span class="line">1.6  selinux 使用</span><br><span class="line">1.6.1  查看安全上下文（给文件或目录打的标签）                      查看文件的  安全上下文  ls  -Z   文件名</span><br><span class="line">查看目录的  安全上下文  ls   -dZ   目录名</span><br><span class="line">查看进程的  安全上下文  ps   aux  -Z    | grep  -i  进程名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  129  ls  -Z   /etc/hosts</span><br><span class="line">  133  ls -dZ  /etc</span><br><span class="line"></span><br><span class="line">  134  ps aux</span><br><span class="line">  135  ps aux    |   grep -i httpd</span><br><span class="line">  136  ps aux -Z | grep -i httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.6.2 安全上下文的组成</span><br><span class="line">用户：角色：访问类型：选项</span><br><span class="line">system_u:object_r:net_conf_t:s0</span><br><span class="line">system_u:object_r:etc_t:s0</span><br><span class="line">system_u:system_r:httpd_t:s0</span><br><span class="line"></span><br><span class="line">1.6.3 常见的访问类型</span><br><span class="line">]<span class="comment"># ls -Z /bin/*</span></span><br><span class="line">]<span class="comment"># ls -Z /etc/*</span></span><br><span class="line"></span><br><span class="line">1.6.4  启用SELINUX之后的一般操作规律。</span><br><span class="line">创建新目录或新文件： 继承父目录的安全上下文。</span><br><span class="line">移动文件  ： 保持原有的访问类型不变</span><br><span class="line">复制文件   :  继承目标目录的安全上下文。</span><br><span class="line"></span><br><span class="line">1.6.5  修改文件的安全上下文</span><br><span class="line">]<span class="comment"># chcon -t  访问类型  文件名        //修改单个文件</span></span><br><span class="line">]<span class="comment"># chcon -R  -t  访问类型  目录名  //递归修改</span></span><br><span class="line"></span><br><span class="line">1.6.6  恢复文件的安全上下文</span><br><span class="line">]<span class="comment"># restorecon  文件名   //恢复单个文件</span></span><br><span class="line">]<span class="comment"># restorecon  -R    目录名   //递归恢复</span></span><br><span class="line"></span><br><span class="line">1.6.7   修改selinux布尔值 （功能开关）</span><br><span class="line">查看布尔值  getsebool   -a</span><br><span class="line">                   getsebool   -a   |  grep  -i   服务名</span><br><span class="line"></span><br><span class="line">修改布尔值  ]<span class="comment"># setsebool  -P   变量名   on|off</span></span><br><span class="line">                    ]<span class="comment"># setsebool  -P   变量名=1|0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在主机51上运行ftp服务，允许匿名用户上传和下载文件到系统的/var/ftp/sharedir目录里。</span><br><span class="line"></span><br><span class="line">  208  rpm  -q  vsftpd</span><br><span class="line">  209  yum -y install  vsftpd</span><br><span class="line">]<span class="comment"># sed -i    '29s/^#//'     /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">]<span class="comment"># sed -n  '29p'   /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">]<span class="comment"># mkdir  /var/ftp/sharedir</span></span><br><span class="line">]<span class="comment"># chmod o+w /var/ftp/sharedir/</span></span><br><span class="line">]<span class="comment">#  systemctl  start  vsftpd</span></span><br><span class="line">cp  /etc/passwd   /var/ftp/sharedir/</span><br><span class="line">cp /etc/hosts  /var/ftp/sharedir/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setenforce  1    不允许匿名用户上传文件</span><br><span class="line"></span><br><span class="line">修改相关的bool值允许匿名用户上传文件</span><br><span class="line">setsebool   -P   ftpd_anon_write   on</span><br><span class="line">setsebool   -P   ftpd_full_access=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在客户端访问ftp服务器</span><br><span class="line">]<span class="comment"># yum -y  install  ftp</span></span><br><span class="line">]<span class="comment">#  ftp   192.168.4.51</span></span><br><span class="line"><span class="built_in">cd</span>  目录            <span class="comment">#切换到ftp服务的目录下</span></span><br><span class="line">get 文件名        <span class="comment">#下载文件</span></span><br><span class="line">lcd   目录名      <span class="comment">#切换客户端的系统目录下</span></span><br><span class="line">put   文件名     <span class="comment">#上传文件</span></span><br><span class="line"></span><br><span class="line">启用selinux  设置允许51主机的网站服务使用8090端口</span><br><span class="line"></span><br><span class="line">根据selinux的日志提示信息，修改配置。</span><br><span class="line">]<span class="comment"># rpm -qa  | grep -i setroubleshoot</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># sed -i '42s/80/8090/' /etc/httpd/conf/httpd.conf</span></span><br><span class="line">]<span class="comment"># systemctl  restart httpd</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># grep setroubleshoot  /var/log/messages  |   tail   -1</span></span><br><span class="line"></span><br><span class="line">Apr  9 23:45:34 db51 setroubleshoot: SELinux is preventing /usr/sbin/httpd from name_bind access on the tcp_socket port 8090. For complete SELinux messages. run sealert -l 48f5ae98-72a4-41dd-9e68-6675755d949c</span><br><span class="line"></span><br><span class="line">显示具体的解决办法</span><br><span class="line">]<span class="comment">#sealert    -l    48f5ae98-72a4-41dd-9e68-6675755d949c</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># semanage port -a -t  http_port_t  -p  tcp 8090</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># systemctl  restart httpd</span></span><br><span class="line">[root@db51 html]<span class="comment"># netstat -utnalp  | grep :8090</span></span><br><span class="line">+++++++++++++++++++++++++++++</span><br><span class="line">二、数据加密与解密</span><br><span class="line">2.1 数据在传输过程中会遇到哪些风险？</span><br><span class="line">截获     ----&gt;   加密</span><br><span class="line">不可否认性/篡改     ----&gt;   数字签名 或 做完整性校验</span><br><span class="line"></span><br><span class="line">2.2 什么是加密？ 把明文 变成密文过程，一般由发送发负责加密</span><br><span class="line"></span><br><span class="line">2.3 什么解密？     把密文变成明文过程，一般有接收方负责解密</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4 数据加密方式及对应的算法</span><br><span class="line">对称加密：加密和解密数据时使用相同的计算规则 算法：DES  和 AES</span><br><span class="line"></span><br><span class="line">非对称加密： 加密和解密数据时使用不同的计算规则（使用密钥对）算法：RSA 和  DSA</span><br><span class="line">                      密钥对分为2个部分： 公钥 用来加密</span><br><span class="line">                                                        私钥 用来解密</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4  什么是算法  ：加密或解密数据是时，使用的计算规则。</span><br><span class="line">                              可以是 口令  （123456）</span><br><span class="line">                              也可以是一串代码（密钥对）</span><br><span class="line"></span><br><span class="line">2.5 使用GPG工具加密</span><br><span class="line">[root@db51 html]<span class="comment"># which gpg</span></span><br><span class="line">/usr/bin/gpg</span><br><span class="line">[root@db51 html]<span class="comment"># rpm -qf /usr/bin/gpg</span></span><br><span class="line">gnupg2-2.0.22-3.el7.x86_64</span><br><span class="line">[root@db51 html]<span class="comment"># rpm -q gnupg2</span></span><br><span class="line">gnupg2-2.0.22-3.el7.x86_64</span><br><span class="line">[root@db51 html]<span class="comment"># gpg   --help</span></span><br><span class="line"></span><br><span class="line">命令格式：   gpg  &lt;选项&gt;  文件名</span><br><span class="line"></span><br><span class="line">在宿主机上添加2个用户并设置密码</span><br><span class="line">useradd  userA</span><br><span class="line">useradd  userB</span><br><span class="line"><span class="built_in">echo</span>  123456 |  passwd  --stdin   userA</span><br><span class="line"><span class="built_in">echo</span>  123456 |  passwd  --stdin   userB</span><br><span class="line">tty1:  ssh  -X   userA@localhost</span><br><span class="line">tty2:  ssh  -X   userB@localhost</span><br><span class="line"></span><br><span class="line">2.5.1 对称加密及解密</span><br><span class="line">-c 加密</span><br><span class="line">-d 解密</span><br><span class="line"></span><br><span class="line">userA -------&gt; userB</span><br><span class="line">发                      收</span><br><span class="line">userA:</span><br><span class="line">]<span class="comment">#md5sum  a.txt</span></span><br><span class="line">]<span class="comment">#gpg -c a.txt  (输入加密口令)</span></span><br><span class="line">]<span class="comment">#mv  a.txt.gpg   /tmp/</span></span><br><span class="line">userB:</span><br><span class="line">]<span class="comment">#gpg  -d  /tmp/a.txt.gpg   &gt;  ~/test.txt   （输入解密口令）</span></span><br><span class="line">]<span class="comment">#cat ~/test.txt</span></span><br><span class="line">]<span class="comment">#md5sum  ~/test.txt</span></span><br><span class="line"></span><br><span class="line">2.5.2 ------------------非对称加密及解密-------------------</span><br><span class="line">--gen-key  创建密钥对</span><br><span class="line">-e  加密</span><br><span class="line">-d  解密</span><br><span class="line">-a  --<span class="built_in">export</span>   导出公钥</span><br><span class="line">--import   导入公钥</span><br><span class="line"></span><br><span class="line">userA  -------&gt; userB</span><br><span class="line">发                      收</span><br><span class="line">加                      解</span><br><span class="line">公钥                   私钥</span><br><span class="line"></span><br><span class="line">dd  <span class="keyword">if</span>=/dev/zero  of=/test.txt  bs=1M  count=1000000</span><br><span class="line">userB:</span><br><span class="line">1  创建密钥对</span><br><span class="line">]$ rm  -rf  ~/.gnupg</span><br><span class="line">]$ gpg  --gen-key</span><br><span class="line">]$ ls ~/.gnupg/</span><br><span class="line">2  导出公钥 并传给发送</span><br><span class="line">]$ gpg -a --<span class="built_in">export</span></span><br><span class="line">]$ gpg -a --<span class="built_in">export</span>  &gt; /tmp/userB.pub</span><br><span class="line">userA:</span><br><span class="line">rm  -rf  ~/.gnupg</span><br><span class="line">1 导入公钥</span><br><span class="line">]$  gpg  --import   /tmp/userB.pub</span><br><span class="line">]$  ls ~/.gnupg/</span><br><span class="line">2 加密明文文件 并传给 接收方</span><br><span class="line">]$  tail  -3  /etc/passwd   &gt;  a.txt</span><br><span class="line">]$ cat a.txt</span><br><span class="line">]$ gpg  -e  -r   panglijing   a.txt</span><br><span class="line">]$ mv  a.txt.gpg   /tmp/</span><br><span class="line">3 接收方userb用户解密加密的文件</span><br><span class="line">]$  cat /tmp/a.txt.gpg</span><br><span class="line">]$ gpg -d /tmp/a.txt.gpg  &gt; ~/b.txt</span><br><span class="line"></span><br><span class="line">2.5.3 -----------------数据签名------------------</span><br><span class="line">签名作用： 验证文件完整性   实现不可否认性</span><br><span class="line">使用私钥签名</span><br><span class="line">使用公钥验证签名</span><br><span class="line">-b  创建签名文件</span><br><span class="line">--verify 验证签名文件</span><br><span class="line"></span><br><span class="line">userB用户使用私钥创建签名文件</span><br><span class="line">   42  head -4 /etc/passwd &gt; c.txt</span><br><span class="line">   43  cat c.txt</span><br><span class="line">   44  gpg -b c.txt   //创建签名文件 会自动调用自己的私钥做签名</span><br><span class="line">   45  ls c.txt.sig</span><br><span class="line">   48  mv c.txt*   /tmp/</span><br><span class="line">   ]$  gpg --fingerprint</span><br><span class="line">userA用户使用导入的userB 的公钥验证签名文件</span><br><span class="line">]$ cat  /tmp/c.txt</span><br><span class="line">]$ gpg --verify /tmp/c.txt.sig (文件内容和签名时一样 提示验证完好 反之提示损坏)</span><br><span class="line"></span><br><span class="line">++++++++++++++++++++++++++++++</span><br><span class="line">扫描 nmap</span><br><span class="line">]<span class="comment"># rpm -q  nmap  || yum  -y  install nmap</span></span><br><span class="line">]<span class="comment"># which   nmap</span></span><br><span class="line">]<span class="comment"># man  nmap   查看帮助信息</span></span><br><span class="line"></span><br><span class="line">namp 命令的语法格式?</span><br><span class="line">]<span class="comment"># nmap  [扫描的方式]   [选项]     &lt;ip地址&gt;</span></span><br><span class="line"></span><br><span class="line">扫描的方式 -sS  -sT   -sU   -sP</span><br><span class="line">选项  -A   -n    -p</span><br><span class="line"></span><br><span class="line">ip地址的表示方式</span><br><span class="line">]<span class="comment"># nmap     172.40.3.144</span></span><br><span class="line">]<span class="comment"># nmap     172.40.3.144-150</span></span><br><span class="line">]<span class="comment"># nmap     172.40.3.144,153,139</span></span><br><span class="line"></span><br><span class="line">]<span class="comment"># nmap  -sP 172.40.3.144</span></span><br><span class="line">]<span class="comment"># nmap  -sP  172.40.3.100</span></span><br><span class="line">]<span class="comment"># nmap  -A   172.40.3.144</span></span><br><span class="line"></span><br><span class="line">21     22      23         25        53      80      110     3306    3128   443</span><br><span class="line">FTP   SSH   telnet   smtp     dns   http     pop3  mysql  squid   https</span><br><span class="line"></span><br><span class="line">]<span class="comment">#nmap  -sS  -n  -p  80   172.40.3.144</span></span><br><span class="line">]<span class="comment"># nmap -sS  -n  -p  8090   192.168.4.51</span></span><br><span class="line">]<span class="comment">#nmap  -sS  -n  -p  21-22,80,3306   172.40.3.144</span></span><br><span class="line"></span><br><span class="line">执行命令 checkstus 可以自定义检查任意台主机上任意服务的运行状态</span><br><span class="line">]<span class="comment"># vim /usr/local/sbin/checkstus</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">port=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="keyword">for</span>  ip   <span class="keyword">in</span>  $*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     nmap -sS -n  -p <span class="variable">$port</span>  <span class="string">"172.40.3.<span class="variable">$ip</span>"</span> | grep -q  open</span><br><span class="line">     <span class="keyword">if</span> [ $? -eq 0  ];<span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">"172.40.3.<span class="variable">$ip</span>  <span class="variable">$port</span> is  open"</span></span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">"172.40.3.<span class="variable">$ip</span>  <span class="variable">$port</span> is  closed"</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">:wq</span><br><span class="line">]<span class="comment">#chmod  +x  /usr/local/sbin/checkstus</span></span><br><span class="line">]<span class="comment"># checkstus 3306  139 144  153 141</span></span><br><span class="line">++++++++++++++++++++++++++++++</span><br><span class="line">抓包tcpdump ：提取tcp数据的命令行工具</span><br><span class="line"></span><br><span class="line">命令格式  ]<span class="comment">#tcmpdump   [选项]    [过滤条件]</span></span><br><span class="line">*默认只抓从主机eth0接口进出的ip包</span><br><span class="line">*默认把抓到的包显示到屏幕上</span><br><span class="line"></span><br><span class="line">选项   -i  网络接口名  -A   -w   -r   -c  数字     //指定抓包个数</span><br><span class="line">过滤条件?</span><br><span class="line"></span><br><span class="line">]<span class="comment">#tcpdump  -i  br1   -A  －w   /tmp/a.cap</span></span><br><span class="line">]<span class="comment">#tcpdump   -A  －r   /tmp/a.cap</span></span><br><span class="line">]<span class="comment">#tcpdump  -i  br1   -A  -c   2</span></span><br><span class="line">]<span class="comment">#tcpdump  -i br1 -A  src 172.40.3.144  and  port  21</span></span><br><span class="line">]<span class="comment"># tcpdump  -i br1 -A  src 172.40.3.144 and  port 21</span></span><br><span class="line">]<span class="comment"># tcpdump  -i br1 -A  src 172.40.3.144 and  \(port 21  or  port 80\)</span></span><br><span class="line"></span><br><span class="line">在52邮件服务器上执行抓包命令：</span><br><span class="line">抓取发送邮件ip包   ]<span class="comment"># tcpdump  -i  eth0  -A  port 25</span></span><br><span class="line">抓取收送邮件ip包   ]<span class="comment"># tcpdump  -i  lo  -A  port 110</span></span><br><span class="line"></span><br><span class="line">  262  tcpdump  -i  lo  -A  port 110</span><br><span class="line"></span><br><span class="line">263  tcpdump  -i  lo  -A  -w /tmp/mail.cap  port 110</span><br><span class="line"></span><br><span class="line">  264  tcpdump  -A  -r /tmp/mail.cap</span><br><span class="line">  265  tcpdump  -A  -r /tmp/mail.cap | grep -i user</span><br><span class="line">  266  tcpdump  -A  -r /tmp/mail.cap | grep -i pass</span><br><span class="line"></span><br><span class="line">]<span class="comment"># scp /tmp/mail.cap   192.168.4.254:/tmp/</span></span><br><span class="line">++++++++++++++++++++++++++++++</span><br><span class="line">协议分析软件wireshark的使用 查看ip包的具体内容</span><br><span class="line">]<span class="comment"># yum -y install  wireshark-*</span></span><br><span class="line">[root@room9pc17 ~]<span class="comment"># rpm -qa  | grep -i wireshark</span></span><br><span class="line">wireshark-1.10.14-7.el7.x86_64</span><br><span class="line">wireshark-gnome-1.10.14-7.el7.x86_64</span><br><span class="line"></span><br><span class="line">telnet localhost  110</span><br><span class="line">：：1        ipv6</span><br><span class="line"> 127.0.0.1 ipv4</span><br><span class="line">打开软件？</span><br><span class="line">OSI参考模型        TCP/IP</span><br><span class="line">应用层                 应用层</span><br><span class="line">会话层</span><br><span class="line">表示层</span><br><span class="line">传输层                 传输层</span><br><span class="line">网络层                 网络层</span><br><span class="line">数据链路层</span><br><span class="line">物理层                 物理层</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-01</title>
      <link href="/2018/04/Security-01/"/>
      <url>/2018/04/Security-01/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line">day01</span><br><span class="line">linux基本防护</span><br><span class="line">用户切换 su</span><br><span class="line">用户提权*</span><br><span class="line">ssh访问控制</span><br><span class="line"></span><br><span class="line">一、linux基本防护</span><br><span class="line">安全分类？</span><br><span class="line">物理安全 ： 保证硬件设备的安全， 制定管理的规章制度</span><br><span class="line">系统安全 ： 保护操作系统安全 （linux基本防护）</span><br><span class="line">应用安全  :   服务的安全（网站 邮件  数据库）</span><br><span class="line">网络安全 ：  限制客户端是否运行访问服务器,防火墙</span><br><span class="line">                   （硬件 软件）</span><br><span class="line">                               rhel7   firewalld</span><br><span class="line">                               rhel6   iptables</span><br><span class="line">数据安全：  数据备份   加密</span><br><span class="line">管理安全 ： 制定管理的规章制度</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">实现安全手段：</span><br><span class="line">技术实现：系统安全   应用安全 网络安全  数据安全</span><br><span class="line">非技术实现： 管理安全  物理安全</span><br><span class="line"></span><br><span class="line">linux基本防护：</span><br><span class="line">用户管理： useradd   userdel   usermod   passwd</span><br><span class="line"></span><br><span class="line">chage命令的使用：</span><br><span class="line">chage  -d  0  用户名   强制用户登录系统后修改登录密码</span><br><span class="line">chage  -E  2018/04/30  yaya109  设置帐号的有效期</span><br><span class="line">chage  -l   用户名   查看帐号信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不允许某个系统用户登录系统的方法：</span><br><span class="line">修改用户的shell</span><br><span class="line">usermod  -s  /sbin/nologin   用户名</span><br><span class="line"></span><br><span class="line">passwd   -S    用户名  //查看用户密码状态</span><br><span class="line">passwd   -l    用户名    //锁定帐号密码</span><br><span class="line">passwd   -u    用户名  //解锁帐号密码</span><br><span class="line"></span><br><span class="line">useradd   【选项】  用户名</span><br><span class="line">添加系统帐号的默认配置文件是哪个？/etc/login.defs</span><br><span class="line">grep  -v  -E  <span class="string">'^$|^#'</span>   /etc/login.defs</span><br><span class="line"></span><br><span class="line">伪装登录提示（字符登录状态提示信息）</span><br><span class="line">把文件内容修改即可</span><br><span class="line">/etc/issue  伪装本地登录提示信息</span><br><span class="line">/etc/issue.net  伪装网络登录提示信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件系统安全？</span><br><span class="line">设置系统最多能够记录执行过的100条历史命令   HISTSIZE</span><br><span class="line">让设置对所有用户生效  /etc/profile</span><br><span class="line">指对某个用户有效  ~/.bash_profile</span><br><span class="line"></span><br><span class="line">  531  grep -n 1000  /etc/profile</span><br><span class="line">  532  sed -i <span class="string">'45s/1000/100/'</span> /etc/profile</span><br><span class="line">  533  sed -n <span class="string">'45p'</span> /etc/profile</span><br><span class="line">  534  <span class="built_in">echo</span>  <span class="variable">$HISTSIZE</span></span><br><span class="line">  535  <span class="built_in">source</span>  /etc/profile</span><br><span class="line">  536  <span class="built_in">echo</span>  <span class="variable">$HISTSIZE</span></span><br><span class="line"></span><br><span class="line">记录历史命令执行的时间</span><br><span class="line">]<span class="comment">#vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span>  HISTTIMEFORMAT=<span class="string">'%F  %T   '</span></span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">]<span class="comment">#source /etc/profile</span></span><br><span class="line">]<span class="comment">#history</span></span><br><span class="line"></span><br><span class="line">把不需要的服务设置为开机不运行</span><br><span class="line">rhel7   systemctl  <span class="built_in">disable</span>|<span class="built_in">enable</span>  服务名</span><br><span class="line">rhel6   chkconfig   服务名  off|on    //命令操作</span><br><span class="line">rhel6   ntsysv                              //图形操作</span><br><span class="line"></span><br><span class="line">rhel6  去掉其他用户对服务启动脚本的执行权限。</span><br><span class="line">chmod  o-x   /etc/init.d/服务启动脚本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">安装系统时最少可以给几个分区？只分一个根分区就可以</span><br><span class="line"></span><br><span class="line">通常分几个分区比较合适？  /     /boot   /var   /home</span><br><span class="line">                                            LV          LV</span><br><span class="line"></span><br><span class="line">交换分区是必须要分的吗？ 什么不需要分交换分区？</span><br><span class="line">不是必须的                         有足够大的物理内存时</span><br><span class="line"></span><br><span class="line">交换分区的空间是从物理硬盘上划分出来。</span><br><span class="line"></span><br><span class="line">分区的挂载方式有哪些？</span><br><span class="line">手动挂载 mount   -t 文件系统类型 -o 选项  分区名   目录名</span><br><span class="line"></span><br><span class="line">开机挂载  /etc/fastab</span><br><span class="line">分区名   挂载点  文件系统类型   挂载选项  0   0</span><br><span class="line">                                                  defaults</span><br><span class="line"></span><br><span class="line">自动挂载 systemctl  start autofs</span><br><span class="line"></span><br><span class="line">挂载分区时的挂载选项有哪些？ ro   rw</span><br><span class="line"></span><br><span class="line">默认挂载defaults时包括哪些挂载选项？</span><br><span class="line">]<span class="comment"># man   mount</span></span><br><span class="line">rw    suid    dev    <span class="built_in">exec</span>   auto  nouser    async</span><br><span class="line"></span><br><span class="line">nosuid  不允许在挂载目录下执行有suid或sgid权限的文件</span><br><span class="line">noexec  不允许在挂载目录下执行二进制文件。</span><br><span class="line"></span><br><span class="line">mount  -t  文件系统类型  -o  nosuid,noexec   分区名 目录名</span><br><span class="line">fdisk /dev/vdb    -&gt;n-&gt;p-&gt;1-&gt;回车-&gt;回车-&gt;w</span><br><span class="line">fdisk  -l  /dev/vdb</span><br><span class="line">mkfs  -t  ext4   /dev/vdb1</span><br><span class="line">mkdir  /disk</span><br><span class="line">mount   -t  ext4  /dev/vdb1  /disk</span><br><span class="line">cp /usr/sbin/useradd   /disk/</span><br><span class="line">chmod  o+x  /disk/useradd</span><br><span class="line">chmod  u+s  /disk/useradd</span><br><span class="line">useradd  yaya119</span><br><span class="line">su  - yaya119</span><br><span class="line">/disk/useradd   yaya201</span><br><span class="line">tail  -1  /etc/passwd</span><br><span class="line"></span><br><span class="line">不允许用户修改系统配置文件或服务的配置文件？</span><br><span class="line">ifcfg-ethX   /etc/hostname   /etc/resolv.conf</span><br><span class="line">httpd.conf   /etc/my.cnf</span><br><span class="line"></span><br><span class="line">给文件加特殊属性。（只有root用户可以操作，同时对root用户也有效）</span><br><span class="line">i  不可变</span><br><span class="line">a 仅可追加</span><br><span class="line"></span><br><span class="line">查看文件的特殊属性</span><br><span class="line">lsattr  文件名</span><br><span class="line"></span><br><span class="line">添加特殊属性</span><br><span class="line">chattr  +属性  文件名</span><br><span class="line"></span><br><span class="line">删除特殊属性</span><br><span class="line">chattr  -属性  文件名</span><br><span class="line"></span><br><span class="line">drop procedure say;</span><br><span class="line">delimiter //</span><br><span class="line">create procedure say(<span class="keyword">in</span> name char(10))</span><br><span class="line">begin</span><br><span class="line">select name;</span><br><span class="line">select * from user <span class="built_in">where</span> name=<span class="string">"@name"</span>;</span><br><span class="line"><span class="built_in">set</span> name=<span class="string">"yaya"</span>;</span><br><span class="line">select name;</span><br><span class="line">end</span><br><span class="line">//</span><br><span class="line">delimiter ;</span><br><span class="line">call say(<span class="string">"root"</span>);</span><br><span class="line">++++++++++++++++++++</span><br><span class="line">用户切换</span><br><span class="line">su      用户名   //只切换用户身份 不切换到用户的系统环境</span><br><span class="line">su  -  用户名    //用户身份和系统环境同时切换</span><br><span class="line"></span><br><span class="line">管理员用户  ------ &gt; 普通用户  （不需要输入密码）</span><br><span class="line">管理员用户  &lt;------  普通用户  (需要知道root密码)</span><br><span class="line">普通用户&lt;----&gt;普通用户 (必须知道对方的密码)</span><br><span class="line"></span><br><span class="line">]<span class="comment">#su   -   -c  "命令"   用户名</span></span><br><span class="line">[yaya109@db51 ~]$ su -  -c <span class="string">"touch  /root/test.txt"</span> root</span><br><span class="line"></span><br><span class="line">+++++++++++++++++++++++</span><br><span class="line">用户提权 : 管理员用户root，设置系统的普通用户登录系统后可以执行管理员用户执行的命令。</span><br><span class="line"></span><br><span class="line">提权修改的配置文件 vim /etc/sudoers  =  visudo</span><br><span class="line">98 root    ALL=(ALL)       ALL</span><br><span class="line"></span><br><span class="line">105 <span class="comment">#%wheel ALL=(ALL)       ALL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提权的语法格式？</span><br><span class="line">注意提权时，要写命令的绝对路径</span><br><span class="line">怎么查看命令的绝对路径？ <span class="built_in">which</span>   命令名</span><br><span class="line"></span><br><span class="line">系统用户名    主机名列表=命令列表，NOPASSWD:  ALL</span><br><span class="line">%用户组名    主机名列表=命令列表 ,  NOPASSWD:  ALL</span><br><span class="line"></span><br><span class="line">普通用户登录系统后，查看可用使用的提权命令？</span><br><span class="line">]$ sudo  -l</span><br><span class="line"></span><br><span class="line">普通用户登录系统后，执行提权命令？</span><br><span class="line">]$ sudo    提权命令</span><br><span class="line"></span><br><span class="line">useradd  webadm</span><br><span class="line">useradd  dbadm</span><br><span class="line"><span class="built_in">echo</span> 123456  | passwd --stdin webadm</span><br><span class="line"><span class="built_in">echo</span> 123456  | passwd --stdin dbadm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置webadm维护网站服务（能够停止或启动服务 和修改服务的配置文件）</span><br><span class="line">]<span class="comment">#which  systemctl</span></span><br><span class="line">]<span class="comment">#which  vim</span></span><br><span class="line"></span><br><span class="line">vim /etc/sudoers</span><br><span class="line">98 root    ALL=(ALL)       ALL</span><br><span class="line">webadm        localhost,db51=/usr/bin/systemctl   *   httpd,/usr/bin/vim  /etc/httpd/conf/httpd.conf，NETWORKING，SOFTWARE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mike    localhost,db1=/sbin/* ,   !/sbin/ifconfig  eth0</span><br><span class="line"></span><br><span class="line">%empgrp   localhost,db51=/sbin/*</span><br><span class="line">:wq!</span><br><span class="line"></span><br><span class="line">groupadd  empgrp</span><br><span class="line">useradd user1</span><br><span class="line">useradd user2</span><br><span class="line">usermod  -G  empgrp  user1</span><br><span class="line">usermod  -G  empgrp  user2</span><br><span class="line"><span class="built_in">echo</span> 123456  | passwd  --stdin  user1</span><br><span class="line"><span class="built_in">echo</span> 123456  | passwd  --stdin  user2</span><br><span class="line"></span><br><span class="line">useradd user3</span><br><span class="line">usermod  -G  empgrp  user3</span><br><span class="line"><span class="built_in">echo</span> 123456  | passwd  --stdin  user3</span><br><span class="line"></span><br><span class="line">使用别名提权（别名名称必须使用大写字母表示）?</span><br><span class="line">*配置文件里有定义好的命令别名 可以把注释去掉直接使用</span><br><span class="line">定义命令别名  Cmnd_Alias   名称 =   命令列表</span><br><span class="line">定义主机别名  Host_Alias     名称 =   主机名列表</span><br><span class="line">定义用户别名  User_Alias     名称  =   用户名列表</span><br><span class="line"></span><br><span class="line">User_Alias     ADMIN  =   webadm, webadm2</span><br><span class="line">Host_Alias     MYPC =   localhost,db51</span><br><span class="line"></span><br><span class="line">ADMIN        MYPC=/usr/bin/systemctl   *   httpd,/usr/bin/vim  /etc/httpd/conf/httpd.conf，NETWORKING，SOFTWARE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启用日志文件记录 提权用户执行过的命令</span><br><span class="line">vim /etc/sudoers</span><br><span class="line">Defaults  logfile=<span class="string">"/var/log/sudo"</span>:wq</span><br><span class="line">:wq!</span><br><span class="line"></span><br><span class="line">*执行过提权命令后 ，会自动创建日志文件</span><br><span class="line">cat    /var/<span class="built_in">log</span>/sudo</span><br><span class="line"></span><br><span class="line">练习：</span><br><span class="line">配置dbadm维护数据库服务（能够停止或启动服务 和修改服务的配置文件）</span><br><span class="line">++++++++++++++++++++++++++++</span><br><span class="line">三、ssh访问控制</span><br><span class="line">3.1常用配置参数    ]<span class="comment"># man   sshd_config</span></span><br><span class="line">3.2黑白名单 :控制连接ssh服务时使用的用户和客户端地址</span><br><span class="line">3.3使用密钥对认证登录</span><br><span class="line"></span><br><span class="line">eth0   192.168.4.51</span><br><span class="line">eth1   192.168.2.51</span><br><span class="line">修改51主机 上ssh服务使用的</span><br><span class="line">ip地址192.168.4.51和端口号2222</span><br><span class="line"></span><br><span class="line">]<span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">17 Port 2222</span><br><span class="line">19 ListenAddress 192.168.4.51</span><br><span class="line">:wq</span><br><span class="line"></span><br><span class="line">]<span class="comment">#systemctl  restart  sshd</span></span><br><span class="line">]<span class="comment">#netstat  -utnalp  | grep  sshd</span></span><br><span class="line"></span><br><span class="line">客户端连接 ]<span class="comment"># ssh -p 2222  -X  192.168.4.51</span></span><br><span class="line"></span><br><span class="line">3.2黑白名单</span><br><span class="line">白名单   在名单列表里的用户可以连接ssh服务</span><br><span class="line">AllowUsers   USER1@HOST   USER2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">黑名单   在名单列表里的用户不可以连接ssh服务</span><br><span class="line">DenyUsers   USER1@HOST    USER2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">只允许从宿主机连接51 ssh服务。连接的使用只能使用51上的admin用户连接，连接的密码是654321。在络中的所有主机上都可以使用root用户连接</span><br><span class="line"></span><br><span class="line">vim  /etc/ssh/sshd_config</span><br><span class="line">AllowUsers    admin@192.168.4.254     root</span><br><span class="line">:wq</span><br><span class="line">]<span class="comment"># systemctl  restart  sshd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置ssh服务验证用户连接的访问为仅密钥对验证登录，连接时输入用户的密码不允许登录。</span><br><span class="line"></span><br><span class="line">密钥对</span><br><span class="line">公钥   用来加密</span><br><span class="line">私钥   用来解密</span><br><span class="line"></span><br><span class="line">客户端配置?</span><br><span class="line">  101  ssh-keygen 创建密钥对</span><br><span class="line">id_rsa   id_rsa.pub</span><br><span class="line">私钥      公钥</span><br><span class="line"></span><br><span class="line">  103  ssh-copy-id  root@192.168.4.52  拷贝公钥给目标ssh服务器</span><br><span class="line"></span><br><span class="line">ssh服务器的配置?</span><br><span class="line">ssh服务存放公钥的文件</span><br><span class="line">[root@db2 ~]<span class="comment"># ls ~/.ssh/authorized_keys</span></span><br><span class="line"></span><br><span class="line">]<span class="comment">#vim /etc/ssh/sshd_config</span></span><br><span class="line">79 PasswordAuthentication  no  不允许密码认证登录</span><br><span class="line">:wq</span><br><span class="line">]<span class="comment"># systemctl  restart  sshd</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Security-01-mine</title>
      <link href="/2018/04/Security-01-user/"/>
      <url>/2018/04/Security-01-user/</url>
      <content type="html"><![CDATA[<p>Linux System Security<br><a id="more"></a></p><h1 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h1><h2 id="账户设置"><a href="#账户设置" class="headerlink" title="账户设置"></a>账户设置</h2><p><code>`</code>shell<br>useradd,userdel,usermod,passwd,chage</p><p>chage -l username //查看用户密码信息<br>chage -d 0 username //下次登录需要修改密码<br>chage -E yyyy-mm-dd username //密码有效期</p><p>passwd</p><p>安装系统最少可以只分1个/分区<br>通常分几个分区比较合适：/ /boot /var /home</p>]]></content>
      
      
        <tags>
            
            <tag> Security </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MySQL 表记录管理</title>
      <link href="/2018/03/MySQL-%E8%AE%B0%E5%BD%95%E7%AE%A1%E7%90%86%EF%BC%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/"/>
      <url>/2018/03/MySQL-%E8%AE%B0%E5%BD%95%E7%AE%A1%E7%90%86%EF%BC%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/</url>
      <content type="html"><![CDATA[<p>insert into,delete,update,select</p><p>“增、删、改、查”</p><a id="more"></a><h4 id="insert-增-（向表中插入新纪录）"><a href="#insert-增-（向表中插入新纪录）" class="headerlink" title="insert 增 （向表中插入新纪录）"></a>insert 增 （向表中插入新纪录）</h4><p>一次插入1记录给所有记录赋值 [1]</p><p>一次插入多条记录给所有记录赋值 [2]</p><p>一次插入1记录给指定记录赋值 [3]</p><p>一次插入多条记录给指定记录赋值 [4]</p><p>[1] insert into ku.biao values(字段值列表);<br>    – insert into userdb.user values()</p><p>[2] insert into ku.biao values(字段值列表),(字段值列表)…;</p><p>[3] insert into ku.biao(字段名列表) values(字段值记录);</p><p>[4] insert into ku.biao(字段名列表) values(字段值列表),(字段值列表)…;</p><h4 id="delete-删-（删除表记录）"><a href="#delete-删-（删除表记录）" class="headerlink" title="delete 删 （删除表记录）"></a>delete 删 （删除表记录）</h4><p>删除所有行[ delete from ku.biao ;]</p><p>删除特定行[ delete from ku.biao where … ;]</p><h4 id="update-改（修改记录字段的值）"><a href="#update-改（修改记录字段的值）" class="headerlink" title="update 改（修改记录字段的值）"></a>update 改（修改记录字段的值）</h4><p>修改所有记录指定字段的值 [5]</p><p>修改指定记录指定字段的值 [6]</p><p>[5] update ku.biao set 字段名=值</p><p>[6] update ku.biao set 字段名=值,字段名=值 where 条件；</p><h4 id="select-查-（单表查询-嵌套查询-多表查询-连接查询）"><a href="#select-查-（单表查询-嵌套查询-多表查询-连接查询）" class="headerlink" title="select 查 （单表查询  嵌套查询  多表查询 连接查询）"></a>select 查 （单表查询  嵌套查询  多表查询 连接查询）</h4><p>select * from db.tb ;</p><p>select * from db.tb where</p><ul><li><p>数值比较    [ 字段名 符号 数字]<br>  [ &gt;、&gt;=、&lt;、&lt;=、=、!= ]<br>  slelect * from db.tb where id&lt;=10;    </p></li><li><p>字符比较<br>  select <em> from db.tb where user=”root”;<br>  select </em> from db.tb where shell!=”/bin/bash”;</p></li><li><p>范围内匹配 [ in between..and ]</p><ul><li>select * from db.tb where id between 1 and 2; (with 1&amp;2)</li><li>select * from db.tb where name in (“root”,”apache”…);</li><li>select * from db.tb where id not in (100,200,300);</li></ul></li><li><p>四则运算 [ + - * / % ]</p><ul><li>select name,uid,gid,uid+gid sum from db.tb;</li><li>select name,age,year(now())-age syear from db.tb where name=”root”;</li><li>select name,uid,gid,uid+gid sum,(uid+gid)/2 avg from db.tb where name=”bin”;</li><li>update userdb.user set age=age+1 where name=tony”;</li></ul></li><li><p>模糊匹配 [ like %零个或多个null不匹配   _一个字符 ]</p><ul><li>select name from db.tb where name like ‘____’;//四个字符</li><li>select name from db.tb where name like ‘_ a _’;//三个字符a中间</li><li>select name from db.tb where name like ‘a%’;//a开头</li><li>select name from db.tb where name like “_ % _”;//两个字符</li></ul></li><li><p>正则匹配 [  ^ $ . [ ] * ]</p><ul><li>select name from db.tb where name regexp ‘[0-9]’; //含数字</li><li>select name from db.tb where name regexp ‘[0-9]$’; //数字结尾</li><li>select name from db.tb where name regexp ‘^ [0-9]’; //数字开头</li><li>select name from db.tb where name regexp ‘….’; //含四个以上字符</li><li>select name from db.tb where name regexp ‘^….$’; //只含四个字符</li><li>select name from db.tb where name regexp ‘^r.*t$’; //r开头，t结尾，中间任意</li></ul></li><li><p>匹配空 [ is null ]</p><ul><li>select * from db.tb where shell is null;</li></ul></li><li><p>匹配非空 [ is not null ]</p></li><li><p>逻辑匹配 [ or and ! ]</p><ul><li>select * from db.tb where uid=&gt;1000 and shell!=”/bin/bash”;</li><li>select * from db.tb where uid=&gt;1000 or shell!=”/bin/bash” ;</li></ul></li><li><p>查询分组</p></li><li><p>查询排序[ order by desc/asc]</p><ul><li>SELECT column_name,column_name <br><br>FROM table_name <br><br>ORDER BY column_name,column_name ASC | DESC; </li></ul></li><li><p>限制查询显示的行数 [ limit ]</p><ul><li>select * from db.tb where uid&gt;10 limit 10 ; //显示结果的前十行</li><li>select * from db.tb where uid&lt;10 limit 2,3 ; //显示结果2nd行后开始，显示3行</li></ul></li><li><p>查询时不显示字段的重复 [ distinct ] </p><ul><li>select distinct shell from db.tb where uid&lt;10;</li></ul></li><li><p>查询时可以做数据统计（聚集函数） </p><ul><li>sum(字段名)    //求和<ul><li>select sum(id) from db.tb;</li></ul></li><li>avg(字段名)        //平均值<ul><li>select avg(age) from db.tb;</li></ul></li><li>max(字段名)    //最大值<ul><li>select min(uid) from db.tb;</li></ul></li><li>min(字段名)        //最小值<ul><li>select min(gid) from db.tb;        </li></ul></li><li>count(字段名)    //计数<ul><li>select count(*) from db.tb where shell=”/bin/bash”;</li></ul></li></ul></li></ul>]]></content>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HEXO START</title>
      <link href="/2018/03/Hexo-Start/"/>
      <url>/2018/03/Hexo-Start/</url>
      <content type="html"><![CDATA[<ul><li>Learn hexo </li><li>Learn Coding.net</li><li>Learn ide.coding.net<a id="more"></a></li><li>push hexo code</li><li>blog running</li><li>Find and change theme</li></ul><hr>]]></content>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hello World</title>
      <link href="/2018/03/hello-world/"/>
      <url>/2018/03/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><a id="more"></a><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
    </entry>
    
  
  
</search>
